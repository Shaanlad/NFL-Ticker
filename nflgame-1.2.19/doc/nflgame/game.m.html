<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>nflgame.game API documentation</title>
    <meta name="description" content="" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#nflgame.game.diff">diff</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#nflgame.game.Drive">Drive</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflgame.game.Drive.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflgame.game.FieldPosition">FieldPosition</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflgame.game.FieldPosition.__init__">__init__</a></li>
    <li class="mono"><a href="#nflgame.game.FieldPosition.add_yards">add_yards</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflgame.game.Game">Game</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflgame.game.Game.__init__">__init__</a></li>
    <li class="mono"><a href="#nflgame.game.Game.game_over">game_over</a></li>
    <li class="mono"><a href="#nflgame.game.Game.is_home">is_home</a></li>
    <li class="mono"><a href="#nflgame.game.Game.max_player_stats">max_player_stats</a></li>
    <li class="mono"><a href="#nflgame.game.Game.nice_score">nice_score</a></li>
    <li class="mono"><a href="#nflgame.game.Game.playing">playing</a></li>
    <li class="mono"><a href="#nflgame.game.Game.save">save</a></li>
    <li class="mono"><a href="#nflgame.game.Game.season">season</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflgame.game.GameClock">GameClock</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflgame.game.GameClock.__init__">__init__</a></li>
    <li class="mono"><a href="#nflgame.game.GameClock.is_final">is_final</a></li>
    <li class="mono"><a href="#nflgame.game.GameClock.is_halftime">is_halftime</a></li>
    <li class="mono"><a href="#nflgame.game.GameClock.is_pregame">is_pregame</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflgame.game.GameDiff">GameDiff</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflgame.game.Play">Play</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflgame.game.Play.__init__">__init__</a></li>
    <li class="mono"><a href="#nflgame.game.Play.has_player">has_player</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflgame.game.PossessionTime">PossessionTime</a></span>
        
          
  <ul>
    <li class="mono"><a href="#nflgame.game.PossessionTime.__init__">__init__</a></li>
    <li class="mono"><a href="#nflgame.game.PossessionTime.total_seconds">total_seconds</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#nflgame.game.TeamStats">TeamStats</a></span>
        
        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">nflgame.game</span> module</h1>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game" class="source">
    <div class="codehilite"><pre><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="kn">as</span> <span class="nn">path</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">urllib2</span>

<span class="kn">from</span> <span class="nn">nflgame</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">nflgame.player</span>
<span class="kn">import</span> <span class="nn">nflgame.sched</span>
<span class="kn">import</span> <span class="nn">nflgame.seq</span>
<span class="kn">import</span> <span class="nn">nflgame.statmap</span>

<span class="n">_MAX_INT</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span>

<span class="n">_jsonf</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;gamecenter-json&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.json.gz&#39;</span><span class="p">)</span>
<span class="n">_json_base_url</span> <span class="o">=</span> <span class="s">&quot;http://www.nfl.com/liveupdate/game-center/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">_gtd.json&quot;</span>

<span class="n">GameDiff</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;GameDiff&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;before&#39;</span><span class="p">,</span> <span class="s">&#39;after&#39;</span><span class="p">,</span> <span class="s">&#39;plays&#39;</span><span class="p">,</span> <span class="s">&#39;players&#39;</span><span class="p">])</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Represents the difference between two points in time of the same game</span>
<span class="sd">in terms of plays and player statistics.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">TeamStats</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;TeamStats&#39;</span><span class="p">,</span>
                       <span class="p">[</span><span class="s">&#39;first_downs&#39;</span><span class="p">,</span> <span class="s">&#39;total_yds&#39;</span><span class="p">,</span> <span class="s">&#39;passing_yds&#39;</span><span class="p">,</span>
                        <span class="s">&#39;rushing_yds&#39;</span><span class="p">,</span> <span class="s">&#39;penalty_cnt&#39;</span><span class="p">,</span> <span class="s">&#39;penalty_yds&#39;</span><span class="p">,</span>
                        <span class="s">&#39;turnovers&#39;</span><span class="p">,</span> <span class="s">&#39;punt_cnt&#39;</span><span class="p">,</span> <span class="s">&#39;punt_yds&#39;</span><span class="p">,</span> <span class="s">&#39;punt_avg&#39;</span><span class="p">,</span>
                        <span class="s">&#39;pos_time&#39;</span><span class="p">])</span>
<span class="sd">&quot;&quot;&quot;A collection of team statistics for an entire game.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">FieldPosition</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents field position.</span>

<span class="sd">    The representation here is an integer offset where the 50 yard line</span>
<span class="sd">    corresponds to &#39;0&#39;. Being in the own territory corresponds to a negative</span>
<span class="sd">    offset while being in the opponent&#39;s territory corresponds to a positive</span>
<span class="sd">    offset.</span>

<span class="sd">    e.g., NE has the ball on the NE 45, the offset is -5.</span>
<span class="sd">    e.g., NE has the ball on the NYG 2, the offset is 48.</span>

<span class="sd">    This representation allows for gains in any particular play to be added</span>
<span class="sd">    to the field offset to get the new field position as the result of the</span>
<span class="sd">    play.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pos_team</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yardline</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">yardline</span> <span class="ow">and</span> <span class="n">offset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos_team</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yardline</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pos_team is the team on offense, and yardline is a string formatted</span>
<span class="sd">        like &#39;team-territory yard-line&#39;. e.g., &quot;NE 32&quot;.</span>

<span class="sd">        An offset can be given directly by specifying an integer for offset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">yardline</span> <span class="o">==</span> <span class="s">&#39;50&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span>

        <span class="n">territory</span><span class="p">,</span> <span class="n">yd_str</span> <span class="o">=</span> <span class="n">yardline</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">yd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">yd_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">territory</span> <span class="o">==</span> <span class="n">pos_team</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">50</span> <span class="o">-</span> <span class="n">yd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">-</span> <span class="n">yd</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;OPP </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">50</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;OWN </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;MIDFIELD&#39;</span>

    <span class="k">def</span> <span class="nf">add_yards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yards</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new field position with the yards added to self.</span>
<span class="sd">        Yards may be negative.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newoffset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">yards</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">newoffset</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PossessionTime</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the amount of time a drive lasted in (minutes, seconds).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clock</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">clock</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">total_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total number of seconds that this possession lasted for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span><span class="p">),</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_time</span> <span class="o">=</span> <span class="n">PossessionTime</span><span class="p">(</span><span class="s">&#39;0:00&#39;</span><span class="p">)</span>
        <span class="n">total_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">60</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.2d</span><span class="s">:</span><span class="si">%.2d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_time</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="n">new_time</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_time</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span> <span class="o">&gt;=</span> <span class="n">other</span>
        <span class="n">new_time</span> <span class="o">=</span> <span class="n">PossessionTime</span><span class="p">(</span><span class="s">&#39;0:00&#39;</span><span class="p">)</span>
        <span class="n">total_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">60</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.2d</span><span class="s">:</span><span class="si">%.2d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_time</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="n">new_time</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_time</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span>


<span class="k">class</span> <span class="nc">GameClock</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the current time in a game. Namely, it keeps track of the</span>
<span class="sd">    quarter and clock time. Also, GameClock can represent whether</span>
<span class="sd">    the game hasn&#39;t started yet, is half time or if it&#39;s over.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qtr</span><span class="p">,</span> <span class="n">clock</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">=</span> <span class="n">qtr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">clock</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qtr</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c"># Let halftime be quarter 3</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pregame</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_halftime</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_final</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">=</span> <span class="s">&#39;Pregame&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">quarter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span>

    <span class="nd">@quarter.setter</span>
    <span class="k">def</span> <span class="nf">quarter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">is_pregame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">==</span> <span class="s">&#39;Pregame&#39;</span>

    <span class="k">def</span> <span class="nf">is_halftime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">==</span> <span class="s">&#39;Halftime&#39;</span>

    <span class="k">def</span> <span class="nf">is_final</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;final&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">__qtr</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">__qtr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_minutes</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_seconds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a nicely formatted string indicating the current time of the</span>
<span class="sd">        game. Examples include &quot;Q1 10:52&quot;, &quot;Q4 1:25&quot;, &quot;Pregame&quot;, &quot;Halftime&quot;</span>
<span class="sd">        and &quot;Final&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qtr</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&#39;Q</span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span>


<span class="k">class</span> <span class="nc">Game</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Game represents a single pre- or regular-season game. It provides a window</span>
<span class="sd">    into the statistics of every player that played into the game, along with</span>
<span class="sd">    the winner of the game, the score and a list of all the scoring plays.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">eid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># If we can&#39;t get a valid JSON data, exit out and return None.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rawData</span> <span class="o">=</span> <span class="n">_get_json_data</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">fpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">URLError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">rawData</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">rawData</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;{}&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">game</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
        <span class="n">game</span><span class="o">.</span><span class="n">rawData</span> <span class="o">=</span> <span class="n">rawData</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">game</span><span class="o">.</span><span class="n">eid</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">game</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">game</span><span class="o">.</span><span class="n">rawData</span><span class="p">)[</span><span class="n">game</span><span class="o">.</span><span class="n">eid</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c"># For when we have rawData (fpath) and no eid.</span>
                <span class="n">game</span><span class="o">.</span><span class="n">eid</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">game</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">game</span><span class="o">.</span><span class="n">rawData</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">game</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">game</span><span class="o">.</span><span class="n">eid</span> <span class="o">=</span> <span class="n">k</span>
                        <span class="n">game</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">v</span>
                        <span class="k">break</span>
                <span class="k">assert</span> <span class="n">game</span><span class="o">.</span><span class="n">eid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">game</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new Game instance given a game identifier.</span>

<span class="sd">        The game identifier is used by NFL.com&#39;s GameCenter live update web</span>
<span class="sd">        pages. It is used to construct a URL to download JSON data for the</span>
<span class="sd">        game.</span>

<span class="sd">        If the game has been completed, the JSON data will be cached to disk</span>
<span class="sd">        so that subsequent accesses will not re-download the data but instead</span>
<span class="sd">        read it from disk.</span>

<span class="sd">        When the JSON data is written to disk, it is compressed using gzip.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Make the schedule info more accessible.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">games</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># Home and team cumulative statistics.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">][</span><span class="s">&#39;abbr&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">away</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">][</span><span class="s">&#39;abbr&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_home</span> <span class="o">=</span> <span class="n">_json_team_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">][</span><span class="s">&#39;stats&#39;</span><span class="p">][</span><span class="s">&#39;team&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_away</span> <span class="o">=</span> <span class="n">_json_team_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">][</span><span class="s">&#39;stats&#39;</span><span class="p">][</span><span class="s">&#39;team&#39;</span><span class="p">])</span>

        <span class="c"># Load up some simple static values.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamekey</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">games</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;gamekey&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;clock&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="n">_tryint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;down&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">togo</span> <span class="o">=</span> <span class="n">_tryint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;togo&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">][</span><span class="s">&#39;score&#39;</span><span class="p">][</span><span class="s">&#39;T&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">][</span><span class="s">&#39;score&#39;</span><span class="p">][</span><span class="s">&#39;T&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;away&#39;</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">&#39;score&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;score_</span><span class="si">%s</span><span class="s">_q</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">team</span><span class="p">,</span> <span class="n">q</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_over</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span><span class="p">)</span>

        <span class="c"># Load the scoring summary into a simple list of strings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;scrsummary&#39;</span><span class="p">])):</span>
            <span class="n">play</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;scrsummary&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> - Q</span><span class="si">%d</span><span class="s"> - </span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s">&#39;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">play</span><span class="p">[</span><span class="s">&#39;team&#39;</span><span class="p">],</span> <span class="n">play</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span> <span class="n">play</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span> <span class="n">play</span><span class="p">[</span><span class="s">&#39;desc&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="c"># Check to see if the game is over, and if so, cache the data.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_over</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">_jsonf</span> <span class="o">%</span> <span class="n">eid</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">team</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns true if team (i.e., &#39;NE&#39;) is the home team.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>

    <span class="k">def</span> <span class="nf">season</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the year of the season this game belongs to.&quot;&quot;&quot;</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">month</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">year</span>

    <span class="k">def</span> <span class="nf">game_over</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;game_over returns true if the game is no longer being played.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">is_final</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">playing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;playing returns true if the game is currently being played.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">is_pregame</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">is_final</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the JSON data to fpath. This is done automatically if the</span>
<span class="sd">        game is over.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fpath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">_jsonf</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">eid</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawData</span><span class="p">,</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Could not cache JSON data. Please &quot;</span> \
                                 <span class="s">&quot;make &#39;</span><span class="si">%s</span><span class="s">&#39; writable.&quot;</span> \
                                 <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nice_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string of the score of the game.</span>
<span class="sd">        e.g., &quot;NE (32) vs. NYG (0)&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s">) at </span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s">)&#39;</span> \
               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">away</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">max_player_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a GenPlayers sequence of player statistics that combines</span>
<span class="sd">        game statistics and play statistics by taking the max value of</span>
<span class="sd">        each corresponding statistic.</span>

<span class="sd">        This is useful when accuracy is desirable. Namely, using only</span>
<span class="sd">        play-by-play data or using only game statistics can be unreliable.</span>
<span class="sd">        That is, both are inconsistently correct.</span>

<span class="sd">        Taking the max values of each statistic reduces the chance of being</span>
<span class="sd">        wrong (particularly for stats that are in both play-by-play data</span>
<span class="sd">        and game statistics), but does not eliminate them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">game_players</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">)</span>
        <span class="n">play_players</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drives</span><span class="o">.</span><span class="n">plays</span><span class="p">()</span><span class="o">.</span><span class="n">players</span><span class="p">())</span>
        <span class="n">max_players</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c"># So this is a little tricky. It&#39;s possible for a player to have</span>
        <span class="c"># only statistics at the play level, and therefore not be represented</span>
        <span class="c"># in the game level statistics. Therefore, we initialize our</span>
        <span class="c"># max_players with play-by-play stats first. Then go back through</span>
        <span class="c"># and combine them with available game statistics.</span>
        <span class="k">for</span> <span class="n">pplay</span> <span class="ow">in</span> <span class="n">play_players</span><span class="p">:</span>
            <span class="n">newp</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">GamePlayerStats</span><span class="p">(</span><span class="n">pplay</span><span class="o">.</span><span class="n">playerid</span><span class="p">,</span>
                                                  <span class="n">pplay</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pplay</span><span class="o">.</span><span class="n">home</span><span class="p">,</span>
                                                  <span class="n">pplay</span><span class="o">.</span><span class="n">team</span><span class="p">)</span>
            <span class="n">maxstats</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pplay</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">maxstats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

            <span class="n">newp</span><span class="o">.</span><span class="n">_overwrite_stats</span><span class="p">(</span><span class="n">maxstats</span><span class="p">)</span>
            <span class="n">max_players</span><span class="p">[</span><span class="n">pplay</span><span class="o">.</span><span class="n">playerid</span><span class="p">]</span> <span class="o">=</span> <span class="n">newp</span>

        <span class="k">for</span> <span class="n">newp</span> <span class="ow">in</span> <span class="n">max_players</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pgame</span> <span class="ow">in</span> <span class="n">game_players</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pgame</span><span class="o">.</span><span class="n">playerid</span> <span class="o">!=</span> <span class="n">newp</span><span class="o">.</span><span class="n">playerid</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">maxstats</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pgame</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">maxstats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">val</span><span class="p">,</span>
                                          <span class="n">newp</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="o">-</span><span class="n">_MAX_INT</span><span class="p">)])</span>

                <span class="n">newp</span><span class="o">.</span><span class="n">_overwrite_stats</span><span class="p">(</span><span class="n">maxstats</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlayerStats</span><span class="p">(</span><span class="n">max_players</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;players&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__players</span> <span class="o">=</span> <span class="n">_json_game_player_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlayerStats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__players</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;drives&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__drives</span> <span class="o">=</span> <span class="n">_json_drives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;drives&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drives</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenDrives</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__drives</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drives</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">diff</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nice_score</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the difference between two points of time in a game in terms of</span>
<span class="sd">    plays and player statistics. The return value is a GameDiff namedtuple</span>
<span class="sd">    with two attributes: plays and players. Each contains *only* the data</span>
<span class="sd">    that is in the after game but not in the before game.</span>

<span class="sd">    This is useful for sending alerts where you&#39;re guaranteed to see each</span>
<span class="sd">    play statistic only once (assuming NFL.com behaves itself).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">after</span><span class="o">.</span><span class="n">eid</span> <span class="o">==</span> <span class="n">before</span><span class="o">.</span><span class="n">eid</span>

    <span class="n">plays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">after_plays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">after</span><span class="o">.</span><span class="n">drives</span><span class="o">.</span><span class="n">plays</span><span class="p">())</span>
    <span class="n">before_plays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">before</span><span class="o">.</span><span class="n">drives</span><span class="o">.</span><span class="n">plays</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">play</span> <span class="ow">in</span> <span class="n">after_plays</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">play</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">before_plays</span><span class="p">:</span>
            <span class="n">plays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">play</span><span class="p">)</span>

    <span class="c"># You might think that updated play data is enough. You could scan</span>
    <span class="c"># it for statistics you&#39;re looking for (like touchdowns).</span>
    <span class="c"># But sometimes a play can sneak in twice if its description gets</span>
    <span class="c"># updated (late call? play review? etc.)</span>
    <span class="c"># Thus, we do a diff on the play statistics for player data too.</span>
    <span class="n">_players</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">after_players</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">after</span><span class="o">.</span><span class="n">max_player_stats</span><span class="p">())</span>
    <span class="n">before_players</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">before</span><span class="o">.</span><span class="n">max_player_stats</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">aplayer</span> <span class="ow">in</span> <span class="n">after_players</span><span class="p">:</span>
        <span class="n">has_before</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">bplayer</span> <span class="ow">in</span> <span class="n">before_players</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">aplayer</span><span class="o">.</span><span class="n">playerid</span> <span class="o">==</span> <span class="n">bplayer</span><span class="o">.</span><span class="n">playerid</span><span class="p">:</span>
                <span class="n">has_before</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">pdiff</span> <span class="o">=</span> <span class="n">aplayer</span> <span class="o">-</span> <span class="n">bplayer</span>
                <span class="k">if</span> <span class="n">pdiff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">_players</span><span class="p">[</span><span class="n">aplayer</span><span class="o">.</span><span class="n">playerid</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdiff</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_before</span><span class="p">:</span>
            <span class="n">_players</span><span class="p">[</span><span class="n">aplayer</span><span class="o">.</span><span class="n">playerid</span><span class="p">]</span> <span class="o">=</span> <span class="n">aplayer</span>
    <span class="n">players</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlayerStats</span><span class="p">(</span><span class="n">_players</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">GameDiff</span><span class="p">(</span><span class="n">before</span><span class="o">=</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="n">after</span><span class="p">,</span> <span class="n">plays</span><span class="o">=</span><span class="n">plays</span><span class="p">,</span> <span class="n">players</span><span class="o">=</span><span class="n">players</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Drive</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drive represents a single drive in an NFL game. It contains a list</span>
<span class="sd">    of all plays that happened in the drive, in chronological order.</span>
<span class="sd">    It also contains meta information about the drive such as the start</span>
<span class="sd">    and stop times and field position, length of possession, the number</span>
<span class="sd">    of first downs and a short descriptive string of the result of the</span>
<span class="sd">    drive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="n">drive_num</span><span class="p">,</span> <span class="n">home_team</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="s">&#39;plays&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">=</span> <span class="n">game</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_num</span> <span class="o">=</span> <span class="n">drive_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;posteam&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">home_team</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_downs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;fds&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">penalty_yds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;penyds&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_yds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ydsgained&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_time</span> <span class="o">=</span> <span class="n">PossessionTime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;postime&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_cnt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;numplays&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_start</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="s">&#39;yrdln&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span>
                                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="s">&#39;time&#39;</span><span class="p">])</span>

        <span class="c"># When the game is over, the yardline isn&#39;t reported. So find the</span>
        <span class="c"># last play that does report a yardline.</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">][</span><span class="s">&#39;yrdln&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">][</span><span class="s">&#39;yrdln&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">playids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">playids</span><span class="p">:</span>
                <span class="n">yrdln</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">)][</span><span class="s">&#39;yrdln&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">yrdln</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">yrdln</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="s">&#39;50&#39;</span><span class="p">)</span>

        <span class="c"># When a drive lasts from Q1 to Q2 or Q3 to Q4, the &#39;end&#39; doesn&#39;t</span>
        <span class="c"># seem to change to the proper quarter. So scan all of the plays</span>
        <span class="c"># and use the maximal quarter listed. (Just taking the last doesn&#39;t</span>
        <span class="c"># seem to always work.)</span>
        <span class="c"># lastplayid = str(max(map(int, data[&#39;plays&#39;].keys())))</span>
        <span class="c"># endqtr = data[&#39;plays&#39;][lastplayid][&#39;qtr&#39;]</span>
        <span class="n">qtrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">maxq</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">qtrs</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="n">maxq</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">][</span><span class="s">&#39;time&#39;</span><span class="p">])</span>

        <span class="c"># One last sanity check. If the end time is less than the start time,</span>
        <span class="c"># then bump the quarter if it seems reasonable.</span>
        <span class="c"># This technique will blow up if a drive lasts more than fifteen</span>
        <span class="c"># minutes and the quarter numbering is messed up.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> \
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="o">.</span><span class="n">quarter</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__plays</span> <span class="o">=</span> <span class="n">_json_plays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plays</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__plays</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the statistics of two drives together.</span>

<span class="sd">        Note that once two drives are added, the following fields</span>
<span class="sd">        automatically get None values: result, field_start, field_end,</span>
<span class="sd">        time_start and time_end.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> \
            <span class="s">&#39;Cannot add drives from different teams &quot;</span><span class="si">%s</span><span class="s">&quot; and &quot;</span><span class="si">%s</span><span class="s">&quot;.&#39;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">team</span><span class="p">)</span>
        <span class="n">new_drive</span> <span class="o">=</span> <span class="n">Drive</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">first_downs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_downs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">first_downs</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">penalty_yds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">penalty_yds</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">penalty_yds</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">total_yds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_yds</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">total_yds</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">pos_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_time</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">pos_time</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">play_cnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_cnt</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">play_cnt</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">__plays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plays</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">__plays</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">field_start</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">time_start</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">time_end</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">new_drive</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> (Start: </span><span class="si">%s</span><span class="s">, End: </span><span class="si">%s</span><span class="s">) </span><span class="si">%s</span><span class="s">&#39;</span> \
               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Play</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Play represents a single play. It contains a list of all players</span>
<span class="sd">    that participated in the play (including offense, defense and special</span>
<span class="sd">    teams). The play also includes meta information about what down it</span>
<span class="sd">    is, field position, clock time, etc.</span>

<span class="sd">    Play objects also contain team-level statistics, such as whether the</span>
<span class="sd">    play was a first down, a fourth down failure, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drive</span><span class="p">,</span> <span class="n">playid</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive</span> <span class="o">=</span> <span class="n">drive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playid</span> <span class="o">=</span> <span class="n">playid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;posteam&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive</span><span class="o">.</span><span class="n">home</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;desc&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">note</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;note&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;down&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yards_togo</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ydstogo&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">touchdown</span> <span class="o">=</span> <span class="s">&#39;touchdown&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yardline</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yardline</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;yrdln&#39;</span><span class="p">])</span>

        <span class="c"># Load team statistics directly into the Play instance.</span>
        <span class="c"># Things like third down attempts, first downs, etc.</span>
        <span class="k">if</span> <span class="s">&#39;0&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">][</span><span class="s">&#39;0&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;statId&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">idmap</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">statvals</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;statId&#39;</span><span class="p">],</span>
                                                  <span class="n">info</span><span class="p">[</span><span class="s">&#39;yards&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">statvals</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c"># Load the sequence of &quot;events&quot; in a play into a list of dictionaries.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">_json_play_events</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">])</span>

        <span class="c"># Now load cumulative player data for this play into</span>
        <span class="c"># a GenPlayerStats generator. We then flatten this data</span>
        <span class="c"># and add it to the play itself so that plays can be</span>
        <span class="c"># filter by these statistics.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__players</span> <span class="o">=</span> <span class="n">_json_play_players</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlayerStats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__players</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="c"># Sometimes we may see duplicate statistics (like tackle</span>
                <span class="c"># assists). Let&#39;s just overwrite in this case, since this</span>
                <span class="c"># data is from the perspective of the play. i.e., there</span>
                <span class="c"># is one assisted tackle rather than two.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">has_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playerid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Whether a player with id playerid participated in this play.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">playerid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__players</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, Q</span><span class="si">%d</span><span class="s">, </span><span class="si">%d</span><span class="s"> and </span><span class="si">%d</span><span class="s">) </span><span class="si">%s</span><span class="s">&#39;</span> \
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;yrdln&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">qtr</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">down</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yards_togo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, Q</span><span class="si">%d</span><span class="s">) </span><span class="si">%s</span><span class="s">&#39;</span> \
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;yrdln&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">qtr</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We use the play description to determine equality because the</span>
<span class="sd">        play description can be changed. (Like when a play is reversed.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">playid</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">playid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">desc</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;__&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span>
        <span class="k">return</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">_json_team_stats</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a team stats JSON entry and converts it to a TeamStats namedtuple.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TeamStats</span><span class="p">(</span>
        <span class="n">first_downs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;totfd&#39;</span><span class="p">]),</span>
        <span class="n">total_yds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;totyds&#39;</span><span class="p">]),</span>
        <span class="n">passing_yds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;pyds&#39;</span><span class="p">]),</span>
        <span class="n">rushing_yds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ryds&#39;</span><span class="p">]),</span>
        <span class="n">penalty_cnt</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;pen&#39;</span><span class="p">]),</span>
        <span class="n">penalty_yds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;penyds&#39;</span><span class="p">]),</span>
        <span class="n">turnovers</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;trnovr&#39;</span><span class="p">]),</span>
        <span class="n">punt_cnt</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;pt&#39;</span><span class="p">]),</span>
        <span class="n">punt_yds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ptyds&#39;</span><span class="p">]),</span>
        <span class="n">punt_avg</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ptavg&#39;</span><span class="p">]),</span>
        <span class="n">pos_time</span><span class="o">=</span><span class="n">PossessionTime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;top&#39;</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">_json_drives</span><span class="p">(</span><span class="n">game</span><span class="p">,</span> <span class="n">home_team</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a home or away JSON entry and converts it to a list of Drive</span>
<span class="sd">    objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">drive_nums</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">drive_num</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">drive_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">drive_num</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">drives</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">drive_num</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">drive_nums</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">Drive</span><span class="p">(</span><span class="n">game</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">home_team</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">drive_num</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s">&#39;game&#39;</span><span class="p">):</span>  <span class="c"># not a valid drive</span>
            <span class="k">continue</span>
        <span class="n">drives</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">drives</span>


<span class="k">def</span> <span class="nf">_json_plays</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a single JSON drive entry (data) and converts it to a list</span>
<span class="sd">    of Play objects. This includes trying to resolve duplicate play</span>
<span class="sd">    conflicts by only taking the first instance of a play.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">seen_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">seen_desc</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c"># Sometimes duplicates have different play ids...</span>
    <span class="k">for</span> <span class="n">playid</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">))):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">playid</span><span class="p">]</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;desc&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;yrdln&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">playid</span> <span class="ow">in</span> <span class="n">seen_ids</span> <span class="ow">or</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">seen_desc</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">seen_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">playid</span><span class="p">)</span>
        <span class="n">seen_desc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
        <span class="n">plays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Play</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span> <span class="n">playid</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">playid</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">plays</span>


<span class="k">def</span> <span class="nf">_json_play_players</span><span class="p">(</span><span class="n">play</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a single JSON play entry (data) and converts it to an OrderedDict</span>
<span class="sd">    of player statistics.</span>

<span class="sd">    play is the instance of Play that this data is part of. It is used</span>
<span class="sd">    to determine whether the player belong to the home team or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">players</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">playerid</span><span class="p">,</span> <span class="n">statcats</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">playerid</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">statcats</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;statId&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">idmap</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">playerid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">players</span><span class="p">:</span>
                <span class="n">home</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="n">drive</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">is_home</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;clubcode&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">home</span><span class="p">:</span>
                    <span class="n">team_name</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="n">drive</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">home</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">team_name</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="n">drive</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">away</span>
                <span class="n">stats</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">PlayPlayerStats</span><span class="p">(</span><span class="n">playerid</span><span class="p">,</span>
                                                       <span class="n">info</span><span class="p">[</span><span class="s">&#39;playerName&#39;</span><span class="p">],</span>
                                                       <span class="n">home</span><span class="p">,</span> <span class="n">team_name</span><span class="p">)</span>
                <span class="n">players</span><span class="p">[</span><span class="n">playerid</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span>
            <span class="n">statvals</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;statId&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;yards&#39;</span><span class="p">])</span>
            <span class="n">players</span><span class="p">[</span><span class="n">playerid</span><span class="p">]</span><span class="o">.</span><span class="n">_add_stats</span><span class="p">(</span><span class="n">statvals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">players</span>


<span class="k">def</span> <span class="nf">_json_play_events</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a single JSON play entry (data) and converts it to a list of events.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">playerid</span><span class="p">,</span> <span class="n">statcats</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">statcats</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;statId&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">idmap</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">statvals</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;statId&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;yards&#39;</span><span class="p">])</span>
            <span class="n">statvals</span><span class="p">[</span><span class="s">&#39;playerid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">playerid</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span> <span class="k">else</span> <span class="n">playerid</span>
            <span class="n">statvals</span><span class="p">[</span><span class="s">&#39;playername&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;playerName&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">None</span>
            <span class="n">statvals</span><span class="p">[</span><span class="s">&#39;team&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;clubcode&#39;</span><span class="p">]</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]),</span> <span class="n">statvals</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>


<span class="k">def</span> <span class="nf">_json_game_player_stats</span><span class="p">(</span><span class="n">game</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses the &#39;home&#39; and &#39;away&#39; team stats and returns an OrderedDict</span>
<span class="sd">    mapping player id to their total game statistics as instances of</span>
<span class="sd">    nflgame.player.GamePlayerStats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">players</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;away&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">categories</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">&#39;stats&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">&#39;stats&#39;</span><span class="p">][</span><span class="n">category</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">raw</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&#39;name&#39;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">stats</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">if</span> <span class="n">pid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">players</span><span class="p">:</span>
                    <span class="n">home</span> <span class="o">=</span> <span class="n">team</span> <span class="o">==</span> <span class="s">&#39;home&#39;</span>
                    <span class="k">if</span> <span class="n">home</span><span class="p">:</span>
                        <span class="n">team_name</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">home</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">team_name</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">away</span>
                    <span class="n">players</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">GamePlayerStats</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span>
                                                                  <span class="n">raw</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span>
                                                                  <span class="n">home</span><span class="p">,</span>
                                                                  <span class="n">team_name</span><span class="p">)</span>
                <span class="n">players</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">_add_stats</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">players</span>


<span class="k">def</span> <span class="nf">_get_json_data</span><span class="p">(</span><span class="n">eid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the JSON data corresponding to the game represented by eid.</span>

<span class="sd">    If the JSON data is already on disk, it is read, decompressed and returned.</span>

<span class="sd">    Otherwise, the JSON data is downloaded from the NFL web site. If the data</span>
<span class="sd">    doesn&#39;t exist yet or there was an error, _get_json_data returns None.</span>

<span class="sd">    If eid is None, then the JSON data is read from the file at fpath.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">eid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">fpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">fpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">fpath</span> <span class="o">=</span> <span class="n">_jsonf</span> <span class="o">%</span> <span class="n">eid</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">_json_base_url</span> <span class="o">%</span> <span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">eid</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">_tryint</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tries to convert v to an integer. If it fails, return 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="nflgame.game.diff">
    <p>def <span class="ident">diff</span>(</p><p>before, after)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the difference between two points of time in a game in terms of
plays and player statistics. The return value is a GameDiff namedtuple
with two attributes: plays and players. Each contains <em>only</em> the data
that is in the after game but not in the before game.</p>
<p>This is useful for sending alerts where you're guaranteed to see each
play statistic only once (assuming NFL.com behaves itself).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.diff', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.diff" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the difference between two points of time in a game in terms of</span>
<span class="sd">    plays and player statistics. The return value is a GameDiff namedtuple</span>
<span class="sd">    with two attributes: plays and players. Each contains *only* the data</span>
<span class="sd">    that is in the after game but not in the before game.</span>

<span class="sd">    This is useful for sending alerts where you&#39;re guaranteed to see each</span>
<span class="sd">    play statistic only once (assuming NFL.com behaves itself).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">after</span><span class="o">.</span><span class="n">eid</span> <span class="o">==</span> <span class="n">before</span><span class="o">.</span><span class="n">eid</span>

    <span class="n">plays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">after_plays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">after</span><span class="o">.</span><span class="n">drives</span><span class="o">.</span><span class="n">plays</span><span class="p">())</span>
    <span class="n">before_plays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">before</span><span class="o">.</span><span class="n">drives</span><span class="o">.</span><span class="n">plays</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">play</span> <span class="ow">in</span> <span class="n">after_plays</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">play</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">before_plays</span><span class="p">:</span>
            <span class="n">plays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">play</span><span class="p">)</span>

    <span class="c"># You might think that updated play data is enough. You could scan</span>
    <span class="c"># it for statistics you&#39;re looking for (like touchdowns).</span>
    <span class="c"># But sometimes a play can sneak in twice if its description gets</span>
    <span class="c"># updated (late call? play review? etc.)</span>
    <span class="c"># Thus, we do a diff on the play statistics for player data too.</span>
    <span class="n">_players</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">after_players</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">after</span><span class="o">.</span><span class="n">max_player_stats</span><span class="p">())</span>
    <span class="n">before_players</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">before</span><span class="o">.</span><span class="n">max_player_stats</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">aplayer</span> <span class="ow">in</span> <span class="n">after_players</span><span class="p">:</span>
        <span class="n">has_before</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">bplayer</span> <span class="ow">in</span> <span class="n">before_players</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">aplayer</span><span class="o">.</span><span class="n">playerid</span> <span class="o">==</span> <span class="n">bplayer</span><span class="o">.</span><span class="n">playerid</span><span class="p">:</span>
                <span class="n">has_before</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">pdiff</span> <span class="o">=</span> <span class="n">aplayer</span> <span class="o">-</span> <span class="n">bplayer</span>
                <span class="k">if</span> <span class="n">pdiff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">_players</span><span class="p">[</span><span class="n">aplayer</span><span class="o">.</span><span class="n">playerid</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdiff</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_before</span><span class="p">:</span>
            <span class="n">_players</span><span class="p">[</span><span class="n">aplayer</span><span class="o">.</span><span class="n">playerid</span><span class="p">]</span> <span class="o">=</span> <span class="n">aplayer</span>
    <span class="n">players</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlayerStats</span><span class="p">(</span><span class="n">_players</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">GameDiff</span><span class="p">(</span><span class="n">before</span><span class="o">=</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="n">after</span><span class="p">,</span> <span class="n">plays</span><span class="o">=</span><span class="n">plays</span><span class="p">,</span> <span class="n">players</span><span class="o">=</span><span class="n">players</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="nflgame.game.Drive" class="name">class <span class="ident">Drive</span></p>
      
  
    <div class="desc"><p>Drive represents a single drive in an NFL game. It contains a list
of all plays that happened in the drive, in chronological order.
It also contains meta information about the drive such as the start
and stop times and field position, length of possession, the number
of first downs and a short descriptive string of the result of the
drive.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Drive', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Drive" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Drive</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Drive represents a single drive in an NFL game. It contains a list</span>
<span class="sd">    of all plays that happened in the drive, in chronological order.</span>
<span class="sd">    It also contains meta information about the drive such as the start</span>
<span class="sd">    and stop times and field position, length of possession, the number</span>
<span class="sd">    of first downs and a short descriptive string of the result of the</span>
<span class="sd">    drive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="n">drive_num</span><span class="p">,</span> <span class="n">home_team</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="s">&#39;plays&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">=</span> <span class="n">game</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive_num</span> <span class="o">=</span> <span class="n">drive_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;posteam&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">home_team</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_downs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;fds&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">penalty_yds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;penyds&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_yds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ydsgained&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_time</span> <span class="o">=</span> <span class="n">PossessionTime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;postime&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_cnt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;numplays&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_start</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="s">&#39;yrdln&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span>
                                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="s">&#39;time&#39;</span><span class="p">])</span>

        <span class="c"># When the game is over, the yardline isn&#39;t reported. So find the</span>
        <span class="c"># last play that does report a yardline.</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">][</span><span class="s">&#39;yrdln&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">][</span><span class="s">&#39;yrdln&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">playids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">playids</span><span class="p">:</span>
                <span class="n">yrdln</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">)][</span><span class="s">&#39;yrdln&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">yrdln</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">yrdln</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="s">&#39;50&#39;</span><span class="p">)</span>

        <span class="c"># When a drive lasts from Q1 to Q2 or Q3 to Q4, the &#39;end&#39; doesn&#39;t</span>
        <span class="c"># seem to change to the proper quarter. So scan all of the plays</span>
        <span class="c"># and use the maximal quarter listed. (Just taking the last doesn&#39;t</span>
        <span class="c"># seem to always work.)</span>
        <span class="c"># lastplayid = str(max(map(int, data[&#39;plays&#39;].keys())))</span>
        <span class="c"># endqtr = data[&#39;plays&#39;][lastplayid][&#39;qtr&#39;]</span>
        <span class="n">qtrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">maxq</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">qtrs</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="n">maxq</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">][</span><span class="s">&#39;time&#39;</span><span class="p">])</span>

        <span class="c"># One last sanity check. If the end time is less than the start time,</span>
        <span class="c"># then bump the quarter if it seems reasonable.</span>
        <span class="c"># This technique will blow up if a drive lasts more than fifteen</span>
        <span class="c"># minutes and the quarter numbering is messed up.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> \
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="o">.</span><span class="n">quarter</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__plays</span> <span class="o">=</span> <span class="n">_json_plays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plays</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__plays</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the statistics of two drives together.</span>

<span class="sd">        Note that once two drives are added, the following fields</span>
<span class="sd">        automatically get None values: result, field_start, field_end,</span>
<span class="sd">        time_start and time_end.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> \
            <span class="s">&#39;Cannot add drives from different teams &quot;</span><span class="si">%s</span><span class="s">&quot; and &quot;</span><span class="si">%s</span><span class="s">&quot;.&#39;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">team</span><span class="p">)</span>
        <span class="n">new_drive</span> <span class="o">=</span> <span class="n">Drive</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">first_downs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_downs</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">first_downs</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">penalty_yds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">penalty_yds</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">penalty_yds</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">total_yds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_yds</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">total_yds</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">pos_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_time</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">pos_time</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">play_cnt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_cnt</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">play_cnt</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">__plays</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plays</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">__plays</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">field_start</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">time_start</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">new_drive</span><span class="o">.</span><span class="n">time_end</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">new_drive</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> (Start: </span><span class="si">%s</span><span class="s">, End: </span><span class="si">%s</span><span class="s">) </span><span class="si">%s</span><span class="s">&#39;</span> \
               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflgame.game.Drive">Drive</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflgame.game.Drive.drive_num" class="name">var <span class="ident">drive_num</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.field_start" class="name">var <span class="ident">field_start</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.first_downs" class="name">var <span class="ident">first_downs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.game" class="name">var <span class="ident">game</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.home" class="name">var <span class="ident">home</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.penalty_yds" class="name">var <span class="ident">penalty_yds</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.play_cnt" class="name">var <span class="ident">play_cnt</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.plays" class="name">var <span class="ident">plays</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.pos_time" class="name">var <span class="ident">pos_time</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.result" class="name">var <span class="ident">result</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.team" class="name">var <span class="ident">team</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.time_end" class="name">var <span class="ident">time_end</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.time_start" class="name">var <span class="ident">time_start</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Drive.total_yds" class="name">var <span class="ident">total_yds</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflgame.game.Drive.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, game, drive_num, home_team, data)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Drive.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Drive.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="n">drive_num</span><span class="p">,</span> <span class="n">home_team</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="s">&#39;plays&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">=</span> <span class="n">game</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drive_num</span> <span class="o">=</span> <span class="n">drive_num</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;posteam&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">==</span> <span class="n">home_team</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_downs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;fds&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">penalty_yds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;penyds&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_yds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ydsgained&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pos_time</span> <span class="o">=</span> <span class="n">PossessionTime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;postime&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">play_cnt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;numplays&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">field_start</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="s">&#39;yrdln&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span>
                                <span class="n">data</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="s">&#39;time&#39;</span><span class="p">])</span>
    <span class="c"># When the game is over, the yardline isn&#39;t reported. So find the</span>
    <span class="c"># last play that does report a yardline.</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">][</span><span class="s">&#39;yrdln&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">][</span><span class="s">&#39;yrdln&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">playids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">playids</span><span class="p">:</span>
            <span class="n">yrdln</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">)][</span><span class="s">&#39;yrdln&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">yrdln</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">yrdln</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field_end</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="s">&#39;50&#39;</span><span class="p">)</span>
    <span class="c"># When a drive lasts from Q1 to Q2 or Q3 to Q4, the &#39;end&#39; doesn&#39;t</span>
    <span class="c"># seem to change to the proper quarter. So scan all of the plays</span>
    <span class="c"># and use the maximal quarter listed. (Just taking the last doesn&#39;t</span>
    <span class="c"># seem to always work.)</span>
    <span class="c"># lastplayid = str(max(map(int, data[&#39;plays&#39;].keys())))</span>
    <span class="c"># endqtr = data[&#39;plays&#39;][lastplayid][&#39;qtr&#39;]</span>
    <span class="n">qtrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="n">maxq</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">qtrs</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="n">maxq</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">][</span><span class="s">&#39;time&#39;</span><span class="p">])</span>
    <span class="c"># One last sanity check. If the end time is less than the start time,</span>
    <span class="c"># then bump the quarter if it seems reasonable.</span>
    <span class="c"># This technique will blow up if a drive lasts more than fifteen</span>
    <span class="c"># minutes and the quarter numbering is messed up.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> \
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="o">.</span><span class="n">quarter</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="o">.</span><span class="n">quarter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__plays</span> <span class="o">=</span> <span class="n">_json_plays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;plays&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plays</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__plays</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflgame.game.FieldPosition" class="name">class <span class="ident">FieldPosition</span></p>
      
  
    <div class="desc"><p>Represents field position.</p>
<p>The representation here is an integer offset where the 50 yard line
corresponds to '0'. Being in the own territory corresponds to a negative
offset while being in the opponent's territory corresponds to a positive
offset.</p>
<p>e.g., NE has the ball on the NE 45, the offset is -5.
e.g., NE has the ball on the NYG 2, the offset is 48.</p>
<p>This representation allows for gains in any particular play to be added
to the field offset to get the new field position as the result of the
play.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.FieldPosition', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.FieldPosition" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">FieldPosition</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents field position.</span>

<span class="sd">    The representation here is an integer offset where the 50 yard line</span>
<span class="sd">    corresponds to &#39;0&#39;. Being in the own territory corresponds to a negative</span>
<span class="sd">    offset while being in the opponent&#39;s territory corresponds to a positive</span>
<span class="sd">    offset.</span>

<span class="sd">    e.g., NE has the ball on the NE 45, the offset is -5.</span>
<span class="sd">    e.g., NE has the ball on the NYG 2, the offset is 48.</span>

<span class="sd">    This representation allows for gains in any particular play to be added</span>
<span class="sd">    to the field offset to get the new field position as the result of the</span>
<span class="sd">    play.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pos_team</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yardline</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">yardline</span> <span class="ow">and</span> <span class="n">offset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos_team</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yardline</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        pos_team is the team on offense, and yardline is a string formatted</span>
<span class="sd">        like &#39;team-territory yard-line&#39;. e.g., &quot;NE 32&quot;.</span>

<span class="sd">        An offset can be given directly by specifying an integer for offset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">yardline</span> <span class="o">==</span> <span class="s">&#39;50&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span>

        <span class="n">territory</span><span class="p">,</span> <span class="n">yd_str</span> <span class="o">=</span> <span class="n">yardline</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">yd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">yd_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">territory</span> <span class="o">==</span> <span class="n">pos_team</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">50</span> <span class="o">-</span> <span class="n">yd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">-</span> <span class="n">yd</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;OPP </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">50</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;OWN </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;MIDFIELD&#39;</span>

    <span class="k">def</span> <span class="nf">add_yards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yards</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new field position with the yards added to self.</span>
<span class="sd">        Yards may be negative.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newoffset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">yards</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">newoffset</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflgame.game.FieldPosition">FieldPosition</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflgame.game.FieldPosition.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, pos_team=None, yardline=None, offset=None)</p>
    </div>
    

    
  
    <div class="desc"><p>pos_team is the team on offense, and yardline is a string formatted
like 'team-territory yard-line'. e.g., "NE 32".</p>
<p>An offset can be given directly by specifying an integer for offset.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.FieldPosition.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.FieldPosition.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos_team</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yardline</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pos_team is the team on offense, and yardline is a string formatted</span>
<span class="sd">    like &#39;team-territory yard-line&#39;. e.g., &quot;NE 32&quot;.</span>
<span class="sd">    An offset can be given directly by specifying an integer for offset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">yardline</span> <span class="o">==</span> <span class="s">&#39;50&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>
    <span class="n">territory</span><span class="p">,</span> <span class="n">yd_str</span> <span class="o">=</span> <span class="n">yardline</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">yd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">yd_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">territory</span> <span class="o">==</span> <span class="n">pos_team</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">50</span> <span class="o">-</span> <span class="n">yd</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">-</span> <span class="n">yd</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.FieldPosition.add_yards">
    <p>def <span class="ident">add_yards</span>(</p><p>self, yards)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a new field position with the yards added to self.
Yards may be negative.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.FieldPosition.add_yards', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.FieldPosition.add_yards" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_yards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yards</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a new field position with the yards added to self.</span>
<span class="sd">    Yards may be negative.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newoffset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">yards</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">newoffset</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflgame.game.Game" class="name">class <span class="ident">Game</span></p>
      
  
    <div class="desc"><p>Game represents a single pre- or regular-season game. It provides a window
into the statistics of every player that played into the game, along with
the winner of the game, the score and a list of all the scoring plays.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Game', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Game" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Game</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Game represents a single pre- or regular-season game. It provides a window</span>
<span class="sd">    into the statistics of every player that played into the game, along with</span>
<span class="sd">    the winner of the game, the score and a list of all the scoring plays.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">eid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># If we can&#39;t get a valid JSON data, exit out and return None.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rawData</span> <span class="o">=</span> <span class="n">_get_json_data</span><span class="p">(</span><span class="n">eid</span><span class="p">,</span> <span class="n">fpath</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">URLError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">rawData</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">rawData</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;{}&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">game</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
        <span class="n">game</span><span class="o">.</span><span class="n">rawData</span> <span class="o">=</span> <span class="n">rawData</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">game</span><span class="o">.</span><span class="n">eid</span> <span class="o">=</span> <span class="n">eid</span>
                <span class="n">game</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">game</span><span class="o">.</span><span class="n">rawData</span><span class="p">)[</span><span class="n">game</span><span class="o">.</span><span class="n">eid</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c"># For when we have rawData (fpath) and no eid.</span>
                <span class="n">game</span><span class="o">.</span><span class="n">eid</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">game</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">game</span><span class="o">.</span><span class="n">rawData</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">game</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">game</span><span class="o">.</span><span class="n">eid</span> <span class="o">=</span> <span class="n">k</span>
                        <span class="n">game</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">v</span>
                        <span class="k">break</span>
                <span class="k">assert</span> <span class="n">game</span><span class="o">.</span><span class="n">eid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">game</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new Game instance given a game identifier.</span>

<span class="sd">        The game identifier is used by NFL.com&#39;s GameCenter live update web</span>
<span class="sd">        pages. It is used to construct a URL to download JSON data for the</span>
<span class="sd">        game.</span>

<span class="sd">        If the game has been completed, the JSON data will be cached to disk</span>
<span class="sd">        so that subsequent accesses will not re-download the data but instead</span>
<span class="sd">        read it from disk.</span>

<span class="sd">        When the JSON data is written to disk, it is compressed using gzip.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Make the schedule info more accessible.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">games</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># Home and team cumulative statistics.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">][</span><span class="s">&#39;abbr&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">away</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">][</span><span class="s">&#39;abbr&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_home</span> <span class="o">=</span> <span class="n">_json_team_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">][</span><span class="s">&#39;stats&#39;</span><span class="p">][</span><span class="s">&#39;team&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_away</span> <span class="o">=</span> <span class="n">_json_team_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">][</span><span class="s">&#39;stats&#39;</span><span class="p">][</span><span class="s">&#39;team&#39;</span><span class="p">])</span>

        <span class="c"># Load up some simple static values.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamekey</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">games</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;gamekey&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;clock&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="n">_tryint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;down&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">togo</span> <span class="o">=</span> <span class="n">_tryint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;togo&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">][</span><span class="s">&#39;score&#39;</span><span class="p">][</span><span class="s">&#39;T&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">][</span><span class="s">&#39;score&#39;</span><span class="p">][</span><span class="s">&#39;T&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;away&#39;</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">&#39;score&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;score_</span><span class="si">%s</span><span class="s">_q</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">team</span><span class="p">,</span> <span class="n">q</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_over</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span><span class="p">)</span>

        <span class="c"># Load the scoring summary into a simple list of strings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;scrsummary&#39;</span><span class="p">])):</span>
            <span class="n">play</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;scrsummary&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> - Q</span><span class="si">%d</span><span class="s"> - </span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s">&#39;</span> \
                <span class="o">%</span> <span class="p">(</span><span class="n">play</span><span class="p">[</span><span class="s">&#39;team&#39;</span><span class="p">],</span> <span class="n">play</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span> <span class="n">play</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span> <span class="n">play</span><span class="p">[</span><span class="s">&#39;desc&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="c"># Check to see if the game is over, and if so, cache the data.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_over</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">_jsonf</span> <span class="o">%</span> <span class="n">eid</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">team</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns true if team (i.e., &#39;NE&#39;) is the home team.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>

    <span class="k">def</span> <span class="nf">season</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the year of the season this game belongs to.&quot;&quot;&quot;</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">month</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">year</span>

    <span class="k">def</span> <span class="nf">game_over</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;game_over returns true if the game is no longer being played.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">is_final</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">playing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;playing returns true if the game is currently being played.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">is_pregame</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">is_final</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the JSON data to fpath. This is done automatically if the</span>
<span class="sd">        game is over.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fpath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">_jsonf</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">eid</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawData</span><span class="p">,</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Could not cache JSON data. Please &quot;</span> \
                                 <span class="s">&quot;make &#39;</span><span class="si">%s</span><span class="s">&#39; writable.&quot;</span> \
                                 <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nice_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string of the score of the game.</span>
<span class="sd">        e.g., &quot;NE (32) vs. NYG (0)&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s">) at </span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s">)&#39;</span> \
               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">away</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">max_player_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a GenPlayers sequence of player statistics that combines</span>
<span class="sd">        game statistics and play statistics by taking the max value of</span>
<span class="sd">        each corresponding statistic.</span>

<span class="sd">        This is useful when accuracy is desirable. Namely, using only</span>
<span class="sd">        play-by-play data or using only game statistics can be unreliable.</span>
<span class="sd">        That is, both are inconsistently correct.</span>

<span class="sd">        Taking the max values of each statistic reduces the chance of being</span>
<span class="sd">        wrong (particularly for stats that are in both play-by-play data</span>
<span class="sd">        and game statistics), but does not eliminate them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">game_players</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">)</span>
        <span class="n">play_players</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drives</span><span class="o">.</span><span class="n">plays</span><span class="p">()</span><span class="o">.</span><span class="n">players</span><span class="p">())</span>
        <span class="n">max_players</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c"># So this is a little tricky. It&#39;s possible for a player to have</span>
        <span class="c"># only statistics at the play level, and therefore not be represented</span>
        <span class="c"># in the game level statistics. Therefore, we initialize our</span>
        <span class="c"># max_players with play-by-play stats first. Then go back through</span>
        <span class="c"># and combine them with available game statistics.</span>
        <span class="k">for</span> <span class="n">pplay</span> <span class="ow">in</span> <span class="n">play_players</span><span class="p">:</span>
            <span class="n">newp</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">GamePlayerStats</span><span class="p">(</span><span class="n">pplay</span><span class="o">.</span><span class="n">playerid</span><span class="p">,</span>
                                                  <span class="n">pplay</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pplay</span><span class="o">.</span><span class="n">home</span><span class="p">,</span>
                                                  <span class="n">pplay</span><span class="o">.</span><span class="n">team</span><span class="p">)</span>
            <span class="n">maxstats</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pplay</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">maxstats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

            <span class="n">newp</span><span class="o">.</span><span class="n">_overwrite_stats</span><span class="p">(</span><span class="n">maxstats</span><span class="p">)</span>
            <span class="n">max_players</span><span class="p">[</span><span class="n">pplay</span><span class="o">.</span><span class="n">playerid</span><span class="p">]</span> <span class="o">=</span> <span class="n">newp</span>

        <span class="k">for</span> <span class="n">newp</span> <span class="ow">in</span> <span class="n">max_players</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pgame</span> <span class="ow">in</span> <span class="n">game_players</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pgame</span><span class="o">.</span><span class="n">playerid</span> <span class="o">!=</span> <span class="n">newp</span><span class="o">.</span><span class="n">playerid</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">maxstats</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pgame</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">maxstats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">val</span><span class="p">,</span>
                                          <span class="n">newp</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="o">-</span><span class="n">_MAX_INT</span><span class="p">)])</span>

                <span class="n">newp</span><span class="o">.</span><span class="n">_overwrite_stats</span><span class="p">(</span><span class="n">maxstats</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlayerStats</span><span class="p">(</span><span class="n">max_players</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;players&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__players</span> <span class="o">=</span> <span class="n">_json_game_player_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlayerStats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__players</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;drives&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__drives</span> <span class="o">=</span> <span class="n">_json_drives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;drives&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drives</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenDrives</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__drives</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drives</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">diff</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nice_score</span><span class="p">()</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflgame.game.Game">Game</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflgame.game.Game.away" class="name">var <span class="ident">away</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.down" class="name">var <span class="ident">down</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.gamekey" class="name">var <span class="ident">gamekey</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.home" class="name">var <span class="ident">home</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.schedule" class="name">var <span class="ident">schedule</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.score_away" class="name">var <span class="ident">score_away</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.score_home" class="name">var <span class="ident">score_home</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.scores" class="name">var <span class="ident">scores</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.stats_away" class="name">var <span class="ident">stats_away</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.stats_home" class="name">var <span class="ident">stats_home</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.time" class="name">var <span class="ident">time</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Game.togo" class="name">var <span class="ident">togo</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflgame.game.Game.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, eid=None, fpath=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a new Game instance given a game identifier.</p>
<p>The game identifier is used by NFL.com's GameCenter live update web
pages. It is used to construct a URL to download JSON data for the
game.</p>
<p>If the game has been completed, the JSON data will be cached to disk
so that subsequent accesses will not re-download the data but instead
read it from disk.</p>
<p>When the JSON data is written to disk, it is compressed using gzip.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Game.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Game.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new Game instance given a game identifier.</span>
<span class="sd">    The game identifier is used by NFL.com&#39;s GameCenter live update web</span>
<span class="sd">    pages. It is used to construct a URL to download JSON data for the</span>
<span class="sd">    game.</span>
<span class="sd">    If the game has been completed, the JSON data will be cached to disk</span>
<span class="sd">    so that subsequent accesses will not re-download the data but instead</span>
<span class="sd">    read it from disk.</span>
<span class="sd">    When the JSON data is written to disk, it is compressed using gzip.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Make the schedule info more accessible.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">games</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="c"># Home and team cumulative statistics.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">][</span><span class="s">&#39;abbr&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">away</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">][</span><span class="s">&#39;abbr&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stats_home</span> <span class="o">=</span> <span class="n">_json_team_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">][</span><span class="s">&#39;stats&#39;</span><span class="p">][</span><span class="s">&#39;team&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stats_away</span> <span class="o">=</span> <span class="n">_json_team_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">][</span><span class="s">&#39;stats&#39;</span><span class="p">][</span><span class="s">&#39;team&#39;</span><span class="p">])</span>
    <span class="c"># Load up some simple static values.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gamekey</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">sched</span><span class="o">.</span><span class="n">games</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">][</span><span class="s">&#39;gamekey&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;clock&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="n">_tryint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;down&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">togo</span> <span class="o">=</span> <span class="n">_tryint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;togo&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;home&#39;</span><span class="p">][</span><span class="s">&#39;score&#39;</span><span class="p">][</span><span class="s">&#39;T&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;away&#39;</span><span class="p">][</span><span class="s">&#39;score&#39;</span><span class="p">][</span><span class="s">&#39;T&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">,</span> <span class="s">&#39;away&#39;</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">team</span><span class="p">][</span><span class="s">&#39;score&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s">&#39;score_</span><span class="si">%s</span><span class="s">_q</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">team</span><span class="p">,</span> <span class="n">q</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_over</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loser</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">away</span><span class="p">)</span>
    <span class="c"># Load the scoring summary into a simple list of strings.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;scrsummary&#39;</span><span class="p">])):</span>
        <span class="n">play</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;scrsummary&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> - Q</span><span class="si">%d</span><span class="s"> - </span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s">&#39;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="n">play</span><span class="p">[</span><span class="s">&#39;team&#39;</span><span class="p">],</span> <span class="n">play</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span> <span class="n">play</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span> <span class="n">play</span><span class="p">[</span><span class="s">&#39;desc&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c"># Check to see if the game is over, and if so, cache the data.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_over</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">_jsonf</span> <span class="o">%</span> <span class="n">eid</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.Game.game_over">
    <p>def <span class="ident">game_over</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>game_over returns true if the game is no longer being played.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Game.game_over', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Game.game_over" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">game_over</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;game_over returns true if the game is no longer being played.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">is_final</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.Game.is_home">
    <p>def <span class="ident">is_home</span>(</p><p>self, team)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns true if team (i.e., 'NE') is the home team.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Game.is_home', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Game.is_home" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">is_home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">team</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns true if team (i.e., &#39;NE&#39;) is the home team.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">team</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.Game.max_player_stats">
    <p>def <span class="ident">max_player_stats</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a GenPlayers sequence of player statistics that combines
game statistics and play statistics by taking the max value of
each corresponding statistic.</p>
<p>This is useful when accuracy is desirable. Namely, using only
play-by-play data or using only game statistics can be unreliable.
That is, both are inconsistently correct.</p>
<p>Taking the max values of each statistic reduces the chance of being
wrong (particularly for stats that are in both play-by-play data
and game statistics), but does not eliminate them.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Game.max_player_stats', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Game.max_player_stats" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">max_player_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a GenPlayers sequence of player statistics that combines</span>
<span class="sd">    game statistics and play statistics by taking the max value of</span>
<span class="sd">    each corresponding statistic.</span>
<span class="sd">    This is useful when accuracy is desirable. Namely, using only</span>
<span class="sd">    play-by-play data or using only game statistics can be unreliable.</span>
<span class="sd">    That is, both are inconsistently correct.</span>
<span class="sd">    Taking the max values of each statistic reduces the chance of being</span>
<span class="sd">    wrong (particularly for stats that are in both play-by-play data</span>
<span class="sd">    and game statistics), but does not eliminate them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">game_players</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">)</span>
    <span class="n">play_players</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drives</span><span class="o">.</span><span class="n">plays</span><span class="p">()</span><span class="o">.</span><span class="n">players</span><span class="p">())</span>
    <span class="n">max_players</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="c"># So this is a little tricky. It&#39;s possible for a player to have</span>
    <span class="c"># only statistics at the play level, and therefore not be represented</span>
    <span class="c"># in the game level statistics. Therefore, we initialize our</span>
    <span class="c"># max_players with play-by-play stats first. Then go back through</span>
    <span class="c"># and combine them with available game statistics.</span>
    <span class="k">for</span> <span class="n">pplay</span> <span class="ow">in</span> <span class="n">play_players</span><span class="p">:</span>
        <span class="n">newp</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">GamePlayerStats</span><span class="p">(</span><span class="n">pplay</span><span class="o">.</span><span class="n">playerid</span><span class="p">,</span>
                                              <span class="n">pplay</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pplay</span><span class="o">.</span><span class="n">home</span><span class="p">,</span>
                                              <span class="n">pplay</span><span class="o">.</span><span class="n">team</span><span class="p">)</span>
        <span class="n">maxstats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pplay</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">maxstats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">newp</span><span class="o">.</span><span class="n">_overwrite_stats</span><span class="p">(</span><span class="n">maxstats</span><span class="p">)</span>
        <span class="n">max_players</span><span class="p">[</span><span class="n">pplay</span><span class="o">.</span><span class="n">playerid</span><span class="p">]</span> <span class="o">=</span> <span class="n">newp</span>
    <span class="k">for</span> <span class="n">newp</span> <span class="ow">in</span> <span class="n">max_players</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">pgame</span> <span class="ow">in</span> <span class="n">game_players</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pgame</span><span class="o">.</span><span class="n">playerid</span> <span class="o">!=</span> <span class="n">newp</span><span class="o">.</span><span class="n">playerid</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">maxstats</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pgame</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">maxstats</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">val</span><span class="p">,</span>
                                      <span class="n">newp</span><span class="o">.</span><span class="n">_stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="o">-</span><span class="n">_MAX_INT</span><span class="p">)])</span>
            <span class="n">newp</span><span class="o">.</span><span class="n">_overwrite_stats</span><span class="p">(</span><span class="n">maxstats</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlayerStats</span><span class="p">(</span><span class="n">max_players</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.Game.nice_score">
    <p>def <span class="ident">nice_score</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a string of the score of the game.
e.g., "NE (32) vs. NYG (0)".</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Game.nice_score', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Game.nice_score" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">nice_score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a string of the score of the game.</span>
<span class="sd">    e.g., &quot;NE (32) vs. NYG (0)&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s">) at </span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s">)&#39;</span> \
           <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">away</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_away</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_home</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.Game.playing">
    <p>def <span class="ident">playing</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>playing returns true if the game is currently being played.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Game.playing', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Game.playing" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">playing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;playing returns true if the game is currently being played.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">is_pregame</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">is_final</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.Game.save">
    <p>def <span class="ident">save</span>(</p><p>self, fpath=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Save the JSON data to fpath. This is done automatically if the
game is over.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Game.save', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Game.save" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the JSON data to fpath. This is done automatically if the</span>
<span class="sd">    game is over.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fpath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fpath</span> <span class="o">=</span> <span class="n">_jsonf</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">eid</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawData</span><span class="p">,</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Could not cache JSON data. Please &quot;</span> \
                             <span class="s">&quot;make &#39;</span><span class="si">%s</span><span class="s">&#39; writable.&quot;</span> \
                             <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.Game.season">
    <p>def <span class="ident">season</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the year of the season this game belongs to.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Game.season', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Game.season" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">season</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the year of the season this game belongs to.&quot;&quot;&quot;</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">month</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">year</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflgame.game.GameClock" class="name">class <span class="ident">GameClock</span></p>
      
  
    <div class="desc"><p>Represents the current time in a game. Namely, it keeps track of the
quarter and clock time. Also, GameClock can represent whether
the game hasn't started yet, is half time or if it's over.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.GameClock', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.GameClock" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">GameClock</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the current time in a game. Namely, it keeps track of the</span>
<span class="sd">    quarter and clock time. Also, GameClock can represent whether</span>
<span class="sd">    the game hasn&#39;t started yet, is half time or if it&#39;s over.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qtr</span><span class="p">,</span> <span class="n">clock</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">=</span> <span class="n">qtr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">clock</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qtr</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c"># Let halftime be quarter 3</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pregame</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_halftime</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_final</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">=</span> <span class="s">&#39;Pregame&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">quarter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span>

    <span class="nd">@quarter.setter</span>
    <span class="k">def</span> <span class="nf">quarter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">is_pregame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">==</span> <span class="s">&#39;Pregame&#39;</span>

    <span class="k">def</span> <span class="nf">is_halftime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">==</span> <span class="s">&#39;Halftime&#39;</span>

    <span class="k">def</span> <span class="nf">is_final</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;final&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">__qtr</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">__qtr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_minutes</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_seconds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a nicely formatted string indicating the current time of the</span>
<span class="sd">        game. Examples include &quot;Q1 10:52&quot;, &quot;Q4 1:25&quot;, &quot;Pregame&quot;, &quot;Halftime&quot;</span>
<span class="sd">        and &quot;Final&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qtr</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&#39;Q</span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflgame.game.GameClock">GameClock</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflgame.game.GameClock.clock" class="name">var <span class="ident">clock</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.GameClock.qtr" class="name">var <span class="ident">qtr</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.GameClock.quarter" class="name">var <span class="ident">quarter</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflgame.game.GameClock.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, qtr, clock)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.GameClock.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.GameClock.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qtr</span><span class="p">,</span> <span class="n">clock</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">=</span> <span class="n">qtr</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">clock</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qtr</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c"># Let halftime be quarter 3</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pregame</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_halftime</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_final</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__qtr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">=</span> <span class="s">&#39;Pregame&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.GameClock.is_final">
    <p>def <span class="ident">is_final</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.GameClock.is_final', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.GameClock.is_final" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">is_final</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&#39;final&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.GameClock.is_halftime">
    <p>def <span class="ident">is_halftime</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.GameClock.is_halftime', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.GameClock.is_halftime" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">is_halftime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">==</span> <span class="s">&#39;Halftime&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.GameClock.is_pregame">
    <p>def <span class="ident">is_pregame</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.GameClock.is_pregame', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.GameClock.is_pregame" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">is_pregame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qtr</span> <span class="o">==</span> <span class="s">&#39;Pregame&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflgame.game.GameDiff" class="name">class <span class="ident">GameDiff</span></p>
      
  
    <div class="desc"><p>GameDiff(before, after, plays, players)</p></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflgame.game.GameDiff">GameDiff</a></li>
          <li>__builtin__.tuple</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflgame.game.GameDiff.after" class="name">var <span class="ident">after</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 1</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.GameDiff.before" class="name">var <span class="ident">before</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 0</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.GameDiff.players" class="name">var <span class="ident">players</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 3</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.GameDiff.plays" class="name">var <span class="ident">plays</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 2</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="nflgame.game.Play" class="name">class <span class="ident">Play</span></p>
      
  
    <div class="desc"><p>Play represents a single play. It contains a list of all players
that participated in the play (including offense, defense and special
teams). The play also includes meta information about what down it
is, field position, clock time, etc.</p>
<p>Play objects also contain team-level statistics, such as whether the
play was a first down, a fourth down failure, etc.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Play', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Play" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Play</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Play represents a single play. It contains a list of all players</span>
<span class="sd">    that participated in the play (including offense, defense and special</span>
<span class="sd">    teams). The play also includes meta information about what down it</span>
<span class="sd">    is, field position, clock time, etc.</span>

<span class="sd">    Play objects also contain team-level statistics, such as whether the</span>
<span class="sd">    play was a first down, a fourth down failure, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drive</span><span class="p">,</span> <span class="n">playid</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drive</span> <span class="o">=</span> <span class="n">drive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playid</span> <span class="o">=</span> <span class="n">playid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;posteam&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive</span><span class="o">.</span><span class="n">home</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;desc&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">note</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;note&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;down&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yards_togo</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ydstogo&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">touchdown</span> <span class="o">=</span> <span class="s">&#39;touchdown&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yardline</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yardline</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;yrdln&#39;</span><span class="p">])</span>

        <span class="c"># Load team statistics directly into the Play instance.</span>
        <span class="c"># Things like third down attempts, first downs, etc.</span>
        <span class="k">if</span> <span class="s">&#39;0&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">][</span><span class="s">&#39;0&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;statId&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">idmap</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">statvals</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;statId&#39;</span><span class="p">],</span>
                                                  <span class="n">info</span><span class="p">[</span><span class="s">&#39;yards&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">statvals</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c"># Load the sequence of &quot;events&quot; in a play into a list of dictionaries.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">_json_play_events</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">])</span>

        <span class="c"># Now load cumulative player data for this play into</span>
        <span class="c"># a GenPlayerStats generator. We then flatten this data</span>
        <span class="c"># and add it to the play itself so that plays can be</span>
        <span class="c"># filter by these statistics.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__players</span> <span class="o">=</span> <span class="n">_json_play_players</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlayerStats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__players</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="c"># Sometimes we may see duplicate statistics (like tackle</span>
                <span class="c"># assists). Let&#39;s just overwrite in this case, since this</span>
                <span class="c"># data is from the perspective of the play. i.e., there</span>
                <span class="c"># is one assisted tackle rather than two.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">has_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playerid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Whether a player with id playerid participated in this play.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">playerid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__players</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, Q</span><span class="si">%d</span><span class="s">, </span><span class="si">%d</span><span class="s"> and </span><span class="si">%d</span><span class="s">) </span><span class="si">%s</span><span class="s">&#39;</span> \
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;yrdln&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">qtr</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">down</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yards_togo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, Q</span><span class="si">%d</span><span class="s">) </span><span class="si">%s</span><span class="s">&#39;</span> \
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;yrdln&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">qtr</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We use the play description to determine equality because the</span>
<span class="sd">        play description can be changed. (Like when a play is reversed.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">playid</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">playid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">desc</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;__&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflgame.game.Play">Play</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflgame.game.Play.data" class="name">var <span class="ident">data</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.desc" class="name">var <span class="ident">desc</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.down" class="name">var <span class="ident">down</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.drive" class="name">var <span class="ident">drive</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.events" class="name">var <span class="ident">events</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.home" class="name">var <span class="ident">home</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.note" class="name">var <span class="ident">note</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.players" class="name">var <span class="ident">players</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.playid" class="name">var <span class="ident">playid</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.team" class="name">var <span class="ident">team</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.touchdown" class="name">var <span class="ident">touchdown</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.Play.yards_togo" class="name">var <span class="ident">yards_togo</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflgame.game.Play.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, drive, playid, data)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Play.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Play.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drive</span><span class="p">,</span> <span class="n">playid</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drive</span> <span class="o">=</span> <span class="n">drive</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">playid</span> <span class="o">=</span> <span class="n">playid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">team</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;posteam&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drive</span><span class="o">.</span><span class="n">home</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;desc&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">note</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;note&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;down&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yards_togo</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;ydstogo&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">touchdown</span> <span class="o">=</span> <span class="s">&#39;touchdown&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yardline</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">GameClock</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;qtr&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yardline</span> <span class="o">=</span> <span class="n">FieldPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;yrdln&#39;</span><span class="p">])</span>
    <span class="c"># Load team statistics directly into the Play instance.</span>
    <span class="c"># Things like third down attempts, first downs, etc.</span>
    <span class="k">if</span> <span class="s">&#39;0&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">][</span><span class="s">&#39;0&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;statId&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">idmap</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">statvals</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">statmap</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;statId&#39;</span><span class="p">],</span>
                                              <span class="n">info</span><span class="p">[</span><span class="s">&#39;yards&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">statvals</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="c"># Load the sequence of &quot;events&quot; in a play into a list of dictionaries.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">_json_play_events</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">])</span>
    <span class="c"># Now load cumulative player data for this play into</span>
    <span class="c"># a GenPlayerStats generator. We then flatten this data</span>
    <span class="c"># and add it to the play itself so that plays can be</span>
    <span class="c"># filter by these statistics.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__players</span> <span class="o">=</span> <span class="n">_json_play_players</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;players&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">GenPlayerStats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__players</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c"># Sometimes we may see duplicate statistics (like tackle</span>
            <span class="c"># assists). Let&#39;s just overwrite in this case, since this</span>
            <span class="c"># data is from the perspective of the play. i.e., there</span>
            <span class="c"># is one assisted tackle rather than two.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.Play.has_player">
    <p>def <span class="ident">has_player</span>(</p><p>self, playerid)</p>
    </div>
    

    
  
    <div class="desc"><p>Whether a player with id playerid participated in this play.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.Play.has_player', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.Play.has_player" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">has_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playerid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Whether a player with id playerid participated in this play.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">playerid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__players</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflgame.game.PossessionTime" class="name">class <span class="ident">PossessionTime</span></p>
      
  
    <div class="desc"><p>Represents the amount of time a drive lasted in (minutes, seconds).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.PossessionTime', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.PossessionTime" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">PossessionTime</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the amount of time a drive lasted in (minutes, seconds).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clock</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">clock</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">total_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total number of seconds that this possession lasted for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span><span class="p">),</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new_time</span> <span class="o">=</span> <span class="n">PossessionTime</span><span class="p">(</span><span class="s">&#39;0:00&#39;</span><span class="p">)</span>
        <span class="n">total_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">60</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.2d</span><span class="s">:</span><span class="si">%.2d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_time</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="n">new_time</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_time</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span> <span class="o">&gt;=</span> <span class="n">other</span>
        <span class="n">new_time</span> <span class="o">=</span> <span class="n">PossessionTime</span><span class="p">(</span><span class="s">&#39;0:00&#39;</span><span class="p">)</span>
        <span class="n">total_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">/</span> <span class="mi">60</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">total_seconds</span> <span class="o">%</span> <span class="mi">60</span>
        <span class="n">new_time</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.2d</span><span class="s">:</span><span class="si">%.2d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_time</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="n">new_time</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_time</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflgame.game.PossessionTime">PossessionTime</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflgame.game.PossessionTime.clock" class="name">var <span class="ident">clock</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="nflgame.game.PossessionTime.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, clock)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.PossessionTime.__init__', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.PossessionTime.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clock</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">clock</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="nflgame.game.PossessionTime.total_seconds">
    <p>def <span class="ident">total_seconds</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the total number of seconds that this possession lasted for.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.game.PossessionTime.total_seconds', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.game.PossessionTime.total_seconds" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">total_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the total number of seconds that this possession lasted for.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="nflgame.game.TeamStats" class="name">class <span class="ident">TeamStats</span></p>
      
  
    <div class="desc"><p>TeamStats(first_downs, total_yds, passing_yds, rushing_yds, penalty_cnt, penalty_yds, turnovers, punt_cnt, punt_yds, punt_avg, pos_time)</p></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#nflgame.game.TeamStats">TeamStats</a></li>
          <li>__builtin__.tuple</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="nflgame.game.TeamStats.first_downs" class="name">var <span class="ident">first_downs</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 0</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.TeamStats.passing_yds" class="name">var <span class="ident">passing_yds</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 2</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.TeamStats.penalty_cnt" class="name">var <span class="ident">penalty_cnt</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 4</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.TeamStats.penalty_yds" class="name">var <span class="ident">penalty_yds</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 5</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.TeamStats.pos_time" class="name">var <span class="ident">pos_time</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 10</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.TeamStats.punt_avg" class="name">var <span class="ident">punt_avg</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 9</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.TeamStats.punt_cnt" class="name">var <span class="ident">punt_cnt</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 7</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.TeamStats.punt_yds" class="name">var <span class="ident">punt_yds</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 8</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.TeamStats.rushing_yds" class="name">var <span class="ident">rushing_yds</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 3</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.TeamStats.total_yds" class="name">var <span class="ident">total_yds</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 1</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="nflgame.game.TeamStats.turnovers" class="name">var <span class="ident">turnovers</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 6</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.1</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
