<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>nflgame.live API documentation</title>
    <meta name="description" content="The live module provides a mechanism of periodically checking which games are
being actively played...." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#nflgame.live.current_games">current_games</a></li>
    <li class="mono"><a href="#nflgame.live.current_year_and_week">current_year_and_week</a></li>
    <li class="mono"><a href="#nflgame.live.run">run</a></li>
  </ul>

    </li>


    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">nflgame.live</span> module</h1>
  <p>The live module provides a mechanism of periodically checking which games are
being actively played.</p>
<p>It requires the third party library pytz to be
installed, which makes sure game times are compared properly with respect
to time zones. pytz can be downloaded from PyPI:
http://pypi.python.org/pypi/pytz/</p>
<p>It works by periodically downloading data from NFL.com for games that started
before the current time. Once a game completes, the live module stops asking
NFL.com for data for that game.</p>
<p>If there are no games being actively played (i.e., it's been more than N hours
since the last game started), then the live module sleeps for longer periods
of time.</p>
<p>Thus, the live module can switch between two different modes: active and
inactive.</p>
<p>In the active mode, the live module downloads data from NFL.com in
short intervals. A transition to an inactive mode occurs when no more games
are being played.</p>
<p>In the inactive mode, the live module only checks if a game is playing (or
about to play) every 15 minutes. If a game is playing or about to play, the
live module switches to the active mode. Otherwise, it stays in the inactive
mode.</p>
<p>With this strategy, if the live module is working properly, you could
theoretically keep it running for the entire season.</p>
<p>(N.B. Half-time is ignored. Games are either being actively played or not.)</p>
<h1>Alpha status</h1>
<p>This module is emphatically in alpha status. I believe things will work OK for
the regular season, but the postseason brings new challenges. Moreover, it
will probably affect the API at least a little bit.</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.live', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.live" class="source">
    <div class="codehilite"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The live module provides a mechanism of periodically checking which games are</span>
<span class="sd">being actively played.</span>

<span class="sd">It requires the third party library pytz to be</span>
<span class="sd">installed, which makes sure game times are compared properly with respect</span>
<span class="sd">to time zones. pytz can be downloaded from PyPI:</span>
<span class="sd">http://pypi.python.org/pypi/pytz/</span>

<span class="sd">It works by periodically downloading data from NFL.com for games that started</span>
<span class="sd">before the current time. Once a game completes, the live module stops asking</span>
<span class="sd">NFL.com for data for that game.</span>

<span class="sd">If there are no games being actively played (i.e., it&#39;s been more than N hours</span>
<span class="sd">since the last game started), then the live module sleeps for longer periods</span>
<span class="sd">of time.</span>

<span class="sd">Thus, the live module can switch between two different modes: active and</span>
<span class="sd">inactive.</span>

<span class="sd">In the active mode, the live module downloads data from NFL.com in</span>
<span class="sd">short intervals. A transition to an inactive mode occurs when no more games</span>
<span class="sd">are being played.</span>

<span class="sd">In the inactive mode, the live module only checks if a game is playing (or</span>
<span class="sd">about to play) every 15 minutes. If a game is playing or about to play, the</span>
<span class="sd">live module switches to the active mode. Otherwise, it stays in the inactive</span>
<span class="sd">mode.</span>

<span class="sd">With this strategy, if the live module is working properly, you could</span>
<span class="sd">theoretically keep it running for the entire season.</span>

<span class="sd">(N.B. Half-time is ignored. Games are either being actively played or not.)</span>

<span class="sd">Alpha status</span>
<span class="sd">============</span>
<span class="sd">This module is emphatically in alpha status. I believe things will work OK for</span>
<span class="sd">the regular season, but the postseason brings new challenges. Moreover, it</span>
<span class="sd">will probably affect the API at least a little bit.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">xml.dom.minidom</span> <span class="kn">as</span> <span class="nn">xml</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pytz</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">nflgame</span>
<span class="kn">import</span> <span class="nn">nflgame.game</span>

<span class="c"># [00:21] &lt;rasher&gt; burntsushi: Alright, the schedule changes on Wednesday 7:00</span>
<span class="c"># UTC during the regular season</span>

<span class="n">_MAX_GAME_TIME</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">6</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The assumed maximum time allowed for a game to complete. This is used to</span>
<span class="sd">determine whether a particular game that isn&#39;t over is currently active.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">_WEEK_INTERVAL</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">12</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">How often to check what the current week is. By default, it is twice a day.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># _CUR_SCHEDULE = &quot;http://www.nfl.com/liveupdate/scorestrip/ss.xml&quot;</span>
<span class="c"># &quot;&quot;&quot;</span>
<span class="c"># Pinged infrequently to discover the current week number, year and week type.</span>
<span class="c"># The actual schedule of games is taken from the schedule module.</span>
<span class="c"># &quot;&quot;&quot;</span>

<span class="n">_CUR_SCHEDULE</span> <span class="o">=</span> <span class="s">&quot;http://static.nfl.com/liveupdate/scorestrip/postseason/ss.xml&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The URL for the XML schedule of the post season. This is only used</span>
<span class="sd">during the post season.</span>

<span class="sd">TODO: How do we know if it&#39;s the post season?</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">_cur_week</span> <span class="o">=</span> <span class="bp">None</span>
<span class="sd">&quot;&quot;&quot;The current week. It is updated infrequently automatically.&quot;&quot;&quot;</span>

<span class="n">_cur_year</span> <span class="o">=</span> <span class="bp">None</span>
<span class="sd">&quot;&quot;&quot;The current year. It is updated infrequently automatically.&quot;&quot;&quot;</span>

<span class="n">_cur_season_phase</span> <span class="o">=</span> <span class="s">&#39;PRE&#39;</span>
<span class="sd">&quot;&quot;&quot;The current phase of the season.&quot;&quot;&quot;</span>

<span class="n">_regular</span> <span class="o">=</span> <span class="bp">False</span>
<span class="sd">&quot;&quot;&quot;True when it&#39;s the regular season.&quot;&quot;&quot;</span>

<span class="n">_last</span> <span class="o">=</span> <span class="bp">None</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A list of the last iteration of games. These are diffed with the current</span>
<span class="sd">iteration of games.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">_completed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A list of game eids that have been completed since the live module started</span>
<span class="sd">checking for updated game stats.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">current_year_and_week</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a tuple (year, week) where year is the current year of the season</span>
<span class="sd">    and week is the current week number of games being played.</span>
<span class="sd">    i.e., (2012, 3).</span>

<span class="sd">    N.B. This always downloads the schedule XML data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_update_week_number</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_cur_year</span><span class="p">,</span> <span class="n">_cur_week</span>


<span class="k">def</span> <span class="nf">current_games</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">week</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;REG&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of game.Games of games that are currently playing.</span>
<span class="sd">    This fetches all current information from NFL.com.</span>

<span class="sd">    If either year or week is none, then the current year and week are</span>
<span class="sd">    fetched from the schedule on NFL.com. If they are *both* provided, then</span>
<span class="sd">    the schedule from NFL.com won&#39;t need to be downloaded, and thus saving</span>
<span class="sd">    time.</span>

<span class="sd">    So for example::</span>

<span class="sd">        year, week = nflgame.live.current_year_and_week()</span>
<span class="sd">        while True:</span>
<span class="sd">            games = nflgame.live.current_games(year, week)</span>
<span class="sd">            # Do something with games</span>
<span class="sd">            time.sleep(60)</span>

<span class="sd">    The kind parameter specifies whether to fetch preseason, regular season</span>
<span class="sd">    or postseason games. Valid values are PRE, REG and POST.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">week</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">week</span> <span class="o">=</span> <span class="n">current_year_and_week</span><span class="p">()</span>

    <span class="n">guesses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">_now</span><span class="p">()</span>
    <span class="n">games</span> <span class="o">=</span> <span class="n">_games_in_week</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">week</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">games</span><span class="p">:</span>
        <span class="n">gametime</span> <span class="o">=</span> <span class="n">_game_datetime</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gametime</span> <span class="o">&gt;=</span> <span class="n">now</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">gametime</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">15</span><span class="p">:</span>
                <span class="n">guesses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">gametime</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">_MAX_GAME_TIME</span><span class="p">:</span>
            <span class="n">guesses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">])</span>

    <span class="c"># Now we have a list of all games that are currently playing, are</span>
    <span class="c"># about to start in less than 15 minutes or have already been playing</span>
    <span class="c"># for _MAX_GAME_TIME (6 hours?). Now fetch data for each of them and</span>
    <span class="c"># rule out games in the last two categories.</span>
    <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">guess</span> <span class="ow">in</span> <span class="n">guesses</span><span class="p">:</span>
        <span class="n">game</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">game</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">game</span><span class="o">.</span><span class="n">playing</span><span class="p">():</span>
            <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">current</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">active_interval</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">inactive_interval</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts checking for games that are currently playing.</span>

<span class="sd">    Every time there is an update, callback will be called with three</span>
<span class="sd">    lists: active, completed and diffs. The active list is a list of</span>
<span class="sd">    game.Game that are currently being played. The completed list is</span>
<span class="sd">    a list of game.Game that have just finished. The diffs list is a</span>
<span class="sd">    list of `nflgame.game.GameDiff` objects, which collects statistics</span>
<span class="sd">    that are new since the last time `callback` was called. A game will</span>
<span class="sd">    appear in the completed list only once, after which that game will</span>
<span class="sd">    not be in either the active or completed lists. No game can ever</span>
<span class="sd">    be in both the `active` and `completed` lists at the same time.</span>

<span class="sd">    It is possible that a game in the active list is not yet playing because</span>
<span class="sd">    it hasn&#39;t started yet. It ends up in the active list because the &quot;pregame&quot;</span>
<span class="sd">    has started on NFL.com&#39;s GameCenter web site, and sometimes game data is</span>
<span class="sd">    partially filled. When this is the case, the &#39;playing&#39; method on</span>
<span class="sd">    a nflgame.game.Game will return False.</span>

<span class="sd">    When in the active mode (see live module description), active_interval</span>
<span class="sd">    specifies the number of seconds to wait between checking for updated game</span>
<span class="sd">    data. Please do not make this number too low to avoid angering NFL.com.</span>
<span class="sd">    If you anger them too much, it is possible that they could ban your IP</span>
<span class="sd">    address.</span>

<span class="sd">    Note that NFL.com&#39;s GameCenter page is updated every 15 seconds, so</span>
<span class="sd">    setting the active_interval much smaller than that is wasteful.</span>

<span class="sd">    When in the inactive mode (see live module description), inactive_interval</span>
<span class="sd">    specifies the number of seconds to wait between checking whether any games</span>
<span class="sd">    have started or are about to start.</span>

<span class="sd">    With the default parameters, run will never stop. However, you may set</span>
<span class="sd">    stop to a Python datetime.datetime value. After time passes the stopping</span>
<span class="sd">    point, run will quit. (Technically, it&#39;s possible that it won&#39;t quit until</span>
<span class="sd">    at most inactive_interval seconds after the stopping point is reached.)</span>
<span class="sd">    The stop value is compared against datetime.datetime.now().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">active</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">last_week_check</span> <span class="o">=</span> <span class="n">_update_week_number</span><span class="p">()</span>

    <span class="c"># Before we start with the main loop, we make a first pass at what we</span>
    <span class="c"># believe to be the active games. Of those, we check to see if any of</span>
    <span class="c"># them are actually already over, and add them to _completed.</span>
    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">_active_games</span><span class="p">(</span><span class="n">inactive_interval</span><span class="p">):</span>
        <span class="n">game</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">])</span>

        <span class="c"># If we couldn&#39;t get a game, that probably means the JSON feed</span>
        <span class="c"># isn&#39;t available yet. (i.e., we&#39;re early.)</span>
        <span class="k">if</span> <span class="n">game</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c"># Otherwise, if the game is over, add it to our list of completed</span>
        <span class="c"># games and move on.</span>
        <span class="k">if</span> <span class="n">game</span><span class="o">.</span><span class="n">game_over</span><span class="p">():</span>
            <span class="n">_completed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">])</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">stop</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_week_check</span> <span class="o">&gt;</span> <span class="n">_WEEK_INTERVAL</span><span class="p">:</span>
            <span class="n">last_week_check</span> <span class="o">=</span> <span class="n">_update_week_number</span><span class="p">()</span>

        <span class="n">games</span> <span class="o">=</span> <span class="n">_active_games</span><span class="p">(</span><span class="n">inactive_interval</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
            <span class="n">active</span> <span class="o">=</span> <span class="n">_run_active</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">games</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">active</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">active_interval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">active</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">_run_inactive</span><span class="p">(</span><span class="n">games</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">inactive_interval</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_run_active</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">games</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The active mode traverses each of the active games and fetches info for</span>
<span class="sd">    each from NFL.com.</span>

<span class="sd">    Then each game (that has info available on NFL.com---that is, the game</span>
<span class="sd">    has started) is added to one of two lists: active and completed, which</span>
<span class="sd">    are passed as the first and second parameters to callback. A game is</span>
<span class="sd">    put in the active list if it&#39;s still being played, and into the completed</span>
<span class="sd">    list if it has finished. In the latter case, it is added to a global store</span>
<span class="sd">    of completed games and will never be passed to callback again.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_last</span>

    <span class="c"># There are no active games, so just quit and return False. Which means</span>
    <span class="c"># we&#39;ll transition to inactive mode.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">games</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">active</span><span class="p">,</span> <span class="n">completed</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">games</span><span class="p">:</span>
        <span class="n">game</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">])</span>

        <span class="c"># If no JSON was retrieved, then we&#39;re probably just a little early.</span>
        <span class="c"># So just ignore it for now---but we&#39;ll keep trying!</span>
        <span class="k">if</span> <span class="n">game</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c"># If the game is over, added it to completed and _completed.</span>
        <span class="k">if</span> <span class="n">game</span><span class="o">.</span><span class="n">game_over</span><span class="p">():</span>
            <span class="n">completed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
            <span class="n">_completed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">active</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>

    <span class="c"># Create a list of game diffs between the active + completed games and</span>
    <span class="c"># whatever is in _last.</span>
    <span class="n">diffs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">game</span> <span class="ow">in</span> <span class="n">active</span> <span class="o">+</span> <span class="n">completed</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">last_game</span> <span class="ow">in</span> <span class="n">_last</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="n">game</span><span class="o">.</span><span class="n">eid</span> <span class="o">!=</span> <span class="n">last_game</span><span class="o">.</span><span class="n">eid</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">game</span> <span class="o">-</span> <span class="n">last_game</span><span class="p">)</span>

    <span class="n">_last</span> <span class="o">=</span> <span class="n">active</span>
    <span class="n">callback</span><span class="p">(</span><span class="n">active</span><span class="p">,</span> <span class="n">completed</span><span class="p">,</span> <span class="n">diffs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">_run_inactive</span><span class="p">(</span><span class="n">games</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The inactive mode simply checks if there are any active games. If there</span>
<span class="sd">    are, inactive mode needs to stop and transition to active mode---thus</span>
<span class="sd">    we return False. If there aren&#39;t any active games, then the inactive</span>
<span class="sd">    mode should continue, where we return True.</span>

<span class="sd">    That is, so long as there are no active games, we go back to sleep.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">games</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">_active_games</span><span class="p">(</span><span class="n">inactive_interval</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of all active games. In this case, an active game is a game</span>
<span class="sd">    that will start within inactive_interval seconds, or has started within</span>
<span class="sd">    _MAX_GAME_TIME seconds in the past.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">games</span> <span class="o">=</span> <span class="n">_games_in_week</span><span class="p">(</span><span class="n">_cur_year</span><span class="p">,</span> <span class="n">_cur_week</span><span class="p">,</span> <span class="n">_cur_season_phase</span><span class="p">)</span>
    <span class="n">active</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">games</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_game_is_active</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">inactive_interval</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">active</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">active</span>


<span class="k">def</span> <span class="nf">_games_in_week</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">week</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;REG&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A list for the games matching the year/week/kind parameters.</span>

<span class="sd">    The kind parameter specifies whether to fetch preseason, regular season</span>
<span class="sd">    or postseason games. Valid values are PRE, REG and POST.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">_search_schedule</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">week</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_game_is_active</span><span class="p">(</span><span class="n">gameinfo</span><span class="p">,</span> <span class="n">inactive_interval</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns true if the game is active. A game is considered active if the</span>
<span class="sd">    game start time is in the past and not in the completed list (which is</span>
<span class="sd">    a private module level variable that is populated automatically) or if the</span>
<span class="sd">    game start time is within inactive_interval seconds from starting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gametime</span> <span class="o">=</span> <span class="n">_game_datetime</span><span class="p">(</span><span class="n">gameinfo</span><span class="p">)</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">_now</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">gametime</span> <span class="o">&gt;=</span> <span class="n">now</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">gametime</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">inactive_interval</span>
    <span class="k">return</span> <span class="n">gameinfo</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_completed</span>


<span class="k">def</span> <span class="nf">_game_datetime</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">][:</span><span class="mi">4</span><span class="p">]),</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;month&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">],</span>
                          <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">%</span> <span class="mi">24</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">minute</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s">&#39;US/Eastern&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_now</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_update_week_number</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">_cur_week</span><span class="p">,</span> <span class="n">_cur_year</span><span class="p">,</span> <span class="n">_cur_season_phase</span>

    <span class="n">dom</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">_CUR_SCHEDULE</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">gms</span> <span class="o">=</span> <span class="n">dom</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s">&#39;gms&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">_cur_week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gms</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">))</span>
    <span class="n">_cur_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gms</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">))</span>

    <span class="n">phase</span> <span class="o">=</span> <span class="n">gms</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">phase</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span><span class="p">:</span>
        <span class="n">_cur_season_phase</span> <span class="o">=</span> <span class="s">&#39;PRE&#39;</span>
    <span class="k">elif</span> <span class="n">phase</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span> <span class="ow">or</span> <span class="n">phase</span> <span class="o">==</span> <span class="s">&#39;PRO&#39;</span><span class="p">:</span>
        <span class="n">_cur_season_phase</span> <span class="o">=</span> <span class="s">&#39;POST&#39;</span>
        <span class="n">_cur_week</span> <span class="o">-=</span> <span class="mi">17</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_cur_season_phase</span> <span class="o">=</span> <span class="s">&#39;REG&#39;</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="nflgame.live.current_games">
    <p>def <span class="ident">current_games</span>(</p><p>year=None, week=None, kind=&#39;REG&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of game.Games of games that are currently playing.
This fetches all current information from NFL.com.</p>
<p>If either year or week is none, then the current year and week are
fetched from the schedule on NFL.com. If they are <em>both</em> provided, then
the schedule from NFL.com won't need to be downloaded, and thus saving
time.</p>
<p>So for example::</p>
<div class="codehilite"><pre>year, week = nflgame.live.current_year_and_week()
while True:
    games = nflgame.live.current_games(year, week)
    # Do something with games
    time.sleep(60)
</pre></div>


<p>The kind parameter specifies whether to fetch preseason, regular season
or postseason games. Valid values are PRE, REG and POST.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.live.current_games', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.live.current_games" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">current_games</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">week</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;REG&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of game.Games of games that are currently playing.</span>
<span class="sd">    This fetches all current information from NFL.com.</span>

<span class="sd">    If either year or week is none, then the current year and week are</span>
<span class="sd">    fetched from the schedule on NFL.com. If they are *both* provided, then</span>
<span class="sd">    the schedule from NFL.com won&#39;t need to be downloaded, and thus saving</span>
<span class="sd">    time.</span>

<span class="sd">    So for example::</span>

<span class="sd">        year, week = nflgame.live.current_year_and_week()</span>
<span class="sd">        while True:</span>
<span class="sd">            games = nflgame.live.current_games(year, week)</span>
<span class="sd">            # Do something with games</span>
<span class="sd">            time.sleep(60)</span>

<span class="sd">    The kind parameter specifies whether to fetch preseason, regular season</span>
<span class="sd">    or postseason games. Valid values are PRE, REG and POST.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">week</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">week</span> <span class="o">=</span> <span class="n">current_year_and_week</span><span class="p">()</span>

    <span class="n">guesses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">_now</span><span class="p">()</span>
    <span class="n">games</span> <span class="o">=</span> <span class="n">_games_in_week</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">week</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">games</span><span class="p">:</span>
        <span class="n">gametime</span> <span class="o">=</span> <span class="n">_game_datetime</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gametime</span> <span class="o">&gt;=</span> <span class="n">now</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">gametime</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">15</span><span class="p">:</span>
                <span class="n">guesses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">gametime</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">_MAX_GAME_TIME</span><span class="p">:</span>
            <span class="n">guesses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">])</span>

    <span class="c"># Now we have a list of all games that are currently playing, are</span>
    <span class="c"># about to start in less than 15 minutes or have already been playing</span>
    <span class="c"># for _MAX_GAME_TIME (6 hours?). Now fetch data for each of them and</span>
    <span class="c"># rule out games in the last two categories.</span>
    <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">guess</span> <span class="ow">in</span> <span class="n">guesses</span><span class="p">:</span>
        <span class="n">game</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">game</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">game</span><span class="o">.</span><span class="n">playing</span><span class="p">():</span>
            <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">current</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nflgame.live.current_year_and_week">
    <p>def <span class="ident">current_year_and_week</span>(</p><p>)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a tuple (year, week) where year is the current year of the season
and week is the current week number of games being played.
i.e., (2012, 3).</p>
<p>N.B. This always downloads the schedule XML data.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.live.current_year_and_week', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.live.current_year_and_week" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">current_year_and_week</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a tuple (year, week) where year is the current year of the season</span>
<span class="sd">    and week is the current week number of games being played.</span>
<span class="sd">    i.e., (2012, 3).</span>

<span class="sd">    N.B. This always downloads the schedule XML data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_update_week_number</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_cur_year</span><span class="p">,</span> <span class="n">_cur_week</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="nflgame.live.run">
    <p>def <span class="ident">run</span>(</p><p>callback, active_interval=15, inactive_interval=900, stop=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Starts checking for games that are currently playing.</p>
<p>Every time there is an update, callback will be called with three
lists: active, completed and diffs. The active list is a list of
game.Game that are currently being played. The completed list is
a list of game.Game that have just finished. The diffs list is a
list of <code>nflgame.game.GameDiff</code> objects, which collects statistics
that are new since the last time <code>callback</code> was called. A game will
appear in the completed list only once, after which that game will
not be in either the active or completed lists. No game can ever
be in both the <code>active</code> and <code>completed</code> lists at the same time.</p>
<p>It is possible that a game in the active list is not yet playing because
it hasn't started yet. It ends up in the active list because the "pregame"
has started on NFL.com's GameCenter web site, and sometimes game data is
partially filled. When this is the case, the 'playing' method on
a nflgame.game.Game will return False.</p>
<p>When in the active mode (see live module description), active_interval
specifies the number of seconds to wait between checking for updated game
data. Please do not make this number too low to avoid angering NFL.com.
If you anger them too much, it is possible that they could ban your IP
address.</p>
<p>Note that NFL.com's GameCenter page is updated every 15 seconds, so
setting the active_interval much smaller than that is wasteful.</p>
<p>When in the inactive mode (see live module description), inactive_interval
specifies the number of seconds to wait between checking whether any games
have started or are about to start.</p>
<p>With the default parameters, run will never stop. However, you may set
stop to a Python datetime.datetime value. After time passes the stopping
point, run will quit. (Technically, it's possible that it won't quit until
at most inactive_interval seconds after the stopping point is reached.)
The stop value is compared against datetime.datetime.now().</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-nflgame.live.run', this);">Show source &equiv;</a></p>
  <div id="source-nflgame.live.run" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">active_interval</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">inactive_interval</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Starts checking for games that are currently playing.</span>

<span class="sd">    Every time there is an update, callback will be called with three</span>
<span class="sd">    lists: active, completed and diffs. The active list is a list of</span>
<span class="sd">    game.Game that are currently being played. The completed list is</span>
<span class="sd">    a list of game.Game that have just finished. The diffs list is a</span>
<span class="sd">    list of `nflgame.game.GameDiff` objects, which collects statistics</span>
<span class="sd">    that are new since the last time `callback` was called. A game will</span>
<span class="sd">    appear in the completed list only once, after which that game will</span>
<span class="sd">    not be in either the active or completed lists. No game can ever</span>
<span class="sd">    be in both the `active` and `completed` lists at the same time.</span>

<span class="sd">    It is possible that a game in the active list is not yet playing because</span>
<span class="sd">    it hasn&#39;t started yet. It ends up in the active list because the &quot;pregame&quot;</span>
<span class="sd">    has started on NFL.com&#39;s GameCenter web site, and sometimes game data is</span>
<span class="sd">    partially filled. When this is the case, the &#39;playing&#39; method on</span>
<span class="sd">    a nflgame.game.Game will return False.</span>

<span class="sd">    When in the active mode (see live module description), active_interval</span>
<span class="sd">    specifies the number of seconds to wait between checking for updated game</span>
<span class="sd">    data. Please do not make this number too low to avoid angering NFL.com.</span>
<span class="sd">    If you anger them too much, it is possible that they could ban your IP</span>
<span class="sd">    address.</span>

<span class="sd">    Note that NFL.com&#39;s GameCenter page is updated every 15 seconds, so</span>
<span class="sd">    setting the active_interval much smaller than that is wasteful.</span>

<span class="sd">    When in the inactive mode (see live module description), inactive_interval</span>
<span class="sd">    specifies the number of seconds to wait between checking whether any games</span>
<span class="sd">    have started or are about to start.</span>

<span class="sd">    With the default parameters, run will never stop. However, you may set</span>
<span class="sd">    stop to a Python datetime.datetime value. After time passes the stopping</span>
<span class="sd">    point, run will quit. (Technically, it&#39;s possible that it won&#39;t quit until</span>
<span class="sd">    at most inactive_interval seconds after the stopping point is reached.)</span>
<span class="sd">    The stop value is compared against datetime.datetime.now().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">active</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">last_week_check</span> <span class="o">=</span> <span class="n">_update_week_number</span><span class="p">()</span>

    <span class="c"># Before we start with the main loop, we make a first pass at what we</span>
    <span class="c"># believe to be the active games. Of those, we check to see if any of</span>
    <span class="c"># them are actually already over, and add them to _completed.</span>
    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">_active_games</span><span class="p">(</span><span class="n">inactive_interval</span><span class="p">):</span>
        <span class="n">game</span> <span class="o">=</span> <span class="n">nflgame</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">Game</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">])</span>

        <span class="c"># If we couldn&#39;t get a game, that probably means the JSON feed</span>
        <span class="c"># isn&#39;t available yet. (i.e., we&#39;re early.)</span>
        <span class="k">if</span> <span class="n">game</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c"># Otherwise, if the game is over, add it to our list of completed</span>
        <span class="c"># games and move on.</span>
        <span class="k">if</span> <span class="n">game</span><span class="o">.</span><span class="n">game_over</span><span class="p">():</span>
            <span class="n">_completed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s">&#39;eid&#39;</span><span class="p">])</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">stop</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_week_check</span> <span class="o">&gt;</span> <span class="n">_WEEK_INTERVAL</span><span class="p">:</span>
            <span class="n">last_week_check</span> <span class="o">=</span> <span class="n">_update_week_number</span><span class="p">()</span>

        <span class="n">games</span> <span class="o">=</span> <span class="n">_active_games</span><span class="p">(</span><span class="n">inactive_interval</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
            <span class="n">active</span> <span class="o">=</span> <span class="n">_run_active</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="n">games</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">active</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">active_interval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">active</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">_run_inactive</span><span class="p">(</span><span class="n">games</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">inactive_interval</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  


  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.1</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
